import{r as d,P as c,m as B,j as e,M as ke,u as De,h as je,v as Ne}from"./index-CMJAelHt.js";import{T as we}from"./TaskForm-ulfx5JSn.js";function Te({title:s,titleId:g,...n},x){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":g},n),s?d.createElement("title",{id:g},s):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const W=d.forwardRef(Te);function Ce({title:s,titleId:g,...n},x){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:x,"aria-labelledby":g},n),s?d.createElement("title",{id:g},s):null,d.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const Me=d.forwardRef(Ce);function Le(s,g){const n=new Date;n.setHours(0,0,0,0);const x=new Date(g);if(x.setHours(0,0,0,0),s.isCompleted)return{task:s,displayDate:x,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};if(!s.startDate){if(!s.dueDate)return{task:s,displayDate:x,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};const o=new Date(s.dueDate);o.setHours(0,0,0,0);const l=o<n,b=o.getTime()===x.getTime();return{task:s,displayDate:x,isOverdue:l,isUrgent:l,urgencyLevel:l?"critical":"normal",shouldDisplay:b}}const m=new Date(s.startDate);m.setHours(0,0,0,0);const u=s.dueDate?new Date(s.dueDate):null;if(u&&u.setHours(0,0,0,0),n<m){const o=x.getTime()===m.getTime();return{task:s,displayDate:m,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:o}}if(u&&n>u){const o=x.getTime()===u.getTime();return{task:s,displayDate:u,isOverdue:!0,isUrgent:!0,urgencyLevel:"critical",shouldDisplay:o}}const h=x.getTime()===n.getTime();if(!u)return{task:s,displayDate:n,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:h};const v=Math.max(1,Math.ceil((u.getTime()-m.getTime())/(1e3*60*60*24))),k=Math.ceil((u.getTime()-n.getTime())/(1e3*60*60*24)),w=(v-k)/v;let f="normal",r=!1;return k<=1?(f="critical",r=!0):k<=3||w>=.8?(f="urgent",r=!0):w>=.6&&(f="urgent",r=!1),{task:s,displayDate:n,isOverdue:!1,isUrgent:r,urgencyLevel:f,shouldDisplay:h}}function A(s,g){return s.map(n=>Le(n,g)).filter(n=>n.shouldDisplay)}function Se(s,g){return g==="critical"?c.URGENT:g==="urgent"&&s.priority!==c.URGENT?c.HIGH:s.priority}const Ee=({isOpen:s,onClose:g,selectedDate:n,tasks:x})=>{const{getGroupById:m}=B();if(!n)return null;const h=A(x,n).sort((r,o)=>{if(r.urgencyLevel!==o.urgencyLevel){const b={critical:3,urgent:2,normal:1};return b[o.urgencyLevel]-b[r.urgencyLevel]}const l={[c.URGENT]:4,[c.HIGH]:3,[c.MEDIUM]:2,[c.LOW]:1};return l[o.task.priority]-l[r.task.priority]}),v=r=>r.toLocaleDateString("vi-VN",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),k=r=>{switch(r){case c.URGENT:return"bg-red-500";case c.HIGH:return"bg-orange-500";case c.MEDIUM:return"bg-yellow-500";case c.LOW:return"bg-green-500";default:return"bg-gray-500"}},w=r=>{switch(r){case c.URGENT:return"Khẩn cấp";case c.HIGH:return"Cao";case c.MEDIUM:return"Trung bình";case c.LOW:return"Thấp";default:return"Không xác định"}},f=r=>{switch(r){case"critical":return"Cực kỳ khẩn cấp";case"urgent":return"Khẩn cấp";default:return""}};return e.jsxs(ke,{isOpen:s,onClose:g,title:`Công việc ngày ${v(n)}`,className:"max-w-2xl",children:[e.jsx("div",{className:"max-h-96 overflow-y-auto",children:h.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:"Không có công việc nào trong ngày này"})}):e.jsx("div",{className:"space-y-3",children:h.map(({task:r,isOverdue:o,urgencyLevel:l})=>{const b=r.groupId?m(r.groupId):null;return e.jsx("div",{className:`p-4 rounded-lg border ${o?"border-red-300 bg-red-50 dark:border-red-600 dark:bg-red-900/20":l==="critical"?"border-red-200 bg-red-25 dark:border-red-700 dark:bg-red-900/10":l==="urgent"?"border-orange-200 bg-orange-25 dark:border-orange-700 dark:bg-orange-900/10":"border-gray-200 bg-gray-50 dark:border-gray-600 dark:bg-gray-700"}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${k(r.priority)}`}),e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:r.title}),o&&e.jsx("span",{className:"text-red-600 font-bold text-sm",title:"Quá hạn",children:"⚠ Quá hạn"}),!o&&l==="critical"&&e.jsxs("span",{className:"text-red-500 font-bold text-sm",title:"Cực kỳ khẩn cấp",children:["🔥 ",f(l)]}),!o&&l==="urgent"&&e.jsxs("span",{className:"text-orange-500 font-bold text-sm",title:"Khẩn cấp",children:["⚡ ",f(l)]})]}),r.description&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:r.description}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Độ ưu tiên:"}),e.jsx("span",{className:"font-medium",children:w(r.priority)})]}),b&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Nhóm:"}),e.jsxs("span",{className:"font-medium",children:[b.icon," ",b.name]})]}),r.startDate&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Bắt đầu:"}),e.jsx("span",{className:"font-medium",children:new Date(r.startDate).toLocaleDateString("vi-VN")})]}),r.dueDate&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{children:"Hạn cuối:"}),e.jsx("span",{className:"font-medium",children:new Date(r.dueDate).toLocaleDateString("vi-VN")})]})]})]})})},r.id)})})}),h.length>0&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:e.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300",children:[e.jsxs("span",{children:["Tổng cộng: ",h.length," công việc"]}),e.jsxs("div",{className:"flex space-x-4",children:[h.filter(r=>r.urgencyLevel==="critical"||r.isOverdue).length>0&&e.jsxs("span",{className:"text-red-600",children:["Khẩn cấp: ",h.filter(r=>r.urgencyLevel==="critical"||r.isOverdue).length]}),h.filter(r=>r.urgencyLevel==="urgent"&&!r.isOverdue).length>0&&e.jsxs("span",{className:"text-orange-600",children:["Cần chú ý: ",h.filter(r=>r.urgencyLevel==="urgent"&&!r.isOverdue).length]})]})]})})]})},Ue=({tasks:s})=>{const[g,n]=d.useState(new Date),[x,m]=d.useState(null),[u,h]=d.useState(null),[v,k]=d.useState(null),[w,f]=d.useState(null),[r,o]=d.useState(null),[l,b]=d.useState(null),[K,O]=d.useState(!1),[z,V]=d.useState(null),{user:S}=De(),{getGroupById:P,getDefaultGroup:J}=B(),{filters:E,toggleTaskCompletion:Y,updateTask:Q}=je(),H=E.groupId?s.filter(t=>t.groupId===E.groupId):s,D=g.getFullYear(),j=g.getMonth(),X=new Date,q=new Date(D,j,1),Z=new Date(D,j+1,0).getDate(),_=q.getDay(),ee=new Date(D,j-1,0),te=_,C=[];for(let t=te;t>0;t--){const a=ee.getDate()-t+1,p=new Date(D,j-1,a);C.push({date:p,day:a,isCurrentMonth:!1,isToday:!1})}for(let t=1;t<=Z;t++){const a=new Date(D,j,t),p=a.toDateString()===X.toDateString();C.push({date:a,day:t,isCurrentMonth:!0,isToday:p})}const re=42-C.length;for(let t=1;t<=re;t++){const a=new Date(D,j+1,t);C.push({date:a,day:t,isCurrentMonth:!1,isToday:!1})}const se=t=>A(H,t),ae=()=>{n(new Date(D,j-1,1))},ne=()=>{n(new Date(D,j+1,1))},oe=()=>{n(new Date)},U=t=>{V(t),O(!0)},le=(t,a)=>{t.preventDefault(),t.stopPropagation(),!a.isCompleted&&h({x:t.clientX,y:t.clientY,task:a})},G=async t=>{if(S)try{await Y(S.uid,t.id,!0),h(null)}catch(a){console.error("Failed to mark task as done:",a)}},R=()=>{h(null),o(null)},ie=(t,a)=>{if(a.isCompleted){t.preventDefault();return}k(a),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",a.id)},ce=(t,a)=>{t.preventDefault(),t.dataTransfer.dropEffect="move",f(a)},de=()=>{f(null)},ue=async(t,a)=>{if(t.preventDefault(),f(null),!v||!S)return;const p=new Date(a);p.setHours(23,59,59,999);try{await Q(S.uid,v.id,{dueDate:p}),k(null)}catch(M){console.error("Failed to update task due date:",M),k(null)}},ge=()=>{k(null),f(null)},xe=(t,a)=>{if(a.isCompleted)return;const p=t.touches[0],M=setTimeout(()=>{o({task:a,x:p.clientX,y:p.clientY})},500);b(M)},he=()=>{l&&(clearTimeout(l),b(null))},me=()=>{l&&(clearTimeout(l),b(null))};d.useEffect(()=>{if(u||r)return document.addEventListener("click",R),()=>document.removeEventListener("click",R)},[u,r]),d.useEffect(()=>()=>{l&&clearTimeout(l)},[l]);const pe=t=>{switch(t){case c.URGENT:return"bg-red-500";case c.HIGH:return"bg-orange-500";case c.MEDIUM:return"bg-yellow-500";case c.LOW:return"bg-green-500";default:return"bg-gray-500"}},ye=["January","February","March","April","May","June","July","August","September","October","November","December"],fe=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],$=(()=>{if(E.groupId){const t=P(E.groupId);return t?`${t.icon} ${t.name}`:"Unknown Group"}return null})();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[ye[j]," ",D]}),$&&e.jsxs("span",{className:"text-sm text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 px-2 py-1 rounded-full",children:["Filtered by: ",$]}),e.jsx("button",{onClick:oe,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Today"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:ae,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(Me,{className:"w-5 h-5"})}),e.jsx("button",{onClick:ne,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(Ne,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:fe.map(t=>e.jsx("div",{className:"p-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:C.map((t,a)=>{const p=se(t.date),M=(w==null?void 0:w.toDateString())===t.date.toDateString();return e.jsxs("div",{className:`min-h-[96px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg transition-colors cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${t.isCurrentMonth?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900"} ${t.isToday?"ring-2 ring-primary-500":""} ${M?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700 border-2":""}`,onDragOver:N=>ce(N,t.date),onDragLeave:de,onDrop:N=>ue(N,t.date),onDoubleClick:()=>U(t.date),title:"Double-click để xem tất cả công việc trong ngày",children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${t.isCurrentMonth?t.isToday?"text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}`,children:t.day}),e.jsxs("div",{className:"space-y-1",children:[p.slice(0,4).map(N=>{const{task:y,isOverdue:L,urgencyLevel:T}=N,I=y.groupId?P(y.groupId):J(),be=Se(y,T),ve=()=>L?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 border border-red-300 dark:border-red-700":T==="critical"?"bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300 border border-red-200 dark:border-red-800":T==="urgent"?"bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 border border-orange-200 dark:border-orange-800":"bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200";return e.jsx("div",{draggable:!y.isCompleted,className:`text-xs p-1 rounded truncate transition-all duration-200 ${ve()} cursor-move hover:opacity-80 ${(v==null?void 0:v.id)===y.id?"opacity-50 scale-95":""}`,title:`${y.title} - ${(I==null?void 0:I.name)||"Default"} ${L?"(OVERDUE)":T==="critical"?"(CRITICAL)":T==="urgent"?"(URGENT)":""}`,onDragStart:i=>{i.stopPropagation(),ie(i,y)},onDragEnd:i=>{i.stopPropagation(),ge()},onDoubleClick:i=>{i.stopPropagation(),m(y)},onContextMenu:i=>{i.stopPropagation(),le(i,y)},onTouchStart:i=>{i.stopPropagation(),xe(i,y)},onTouchEnd:i=>{i.stopPropagation(),he()},onTouchMove:i=>{i.stopPropagation(),me()},children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1 flex-1 min-w-0",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${pe(be)}`}),e.jsx("span",{className:"truncate",children:y.title}),L&&e.jsx("span",{className:"text-red-600 font-bold",title:"Overdue",children:"⚠"}),!L&&T==="critical"&&e.jsx("span",{className:"text-red-500 font-bold",title:"Critical urgency",children:"🔥"}),!L&&T==="urgent"&&e.jsx("span",{className:"text-orange-500 font-bold",title:"Urgent",children:"⚡"})]}),e.jsx("button",{className:"ml-1 text-gray-400 hover:text-gray-600 lg:hidden flex-shrink-0",onClick:i=>{i.stopPropagation();const F=i.currentTarget.getBoundingClientRect();o({task:y,x:F.right,y:F.bottom})},onDoubleClick:i=>i.stopPropagation(),"aria-label":"Tùy chọn task",children:"⋮"}),e.jsx("span",{className:"text-gray-400 text-xs hidden lg:block",children:"⋮⋮"})]})},y.id)}),p.length>4&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center cursor-pointer hover:text-gray-700 dark:hover:text-gray-300",onClick:N=>{N.stopPropagation(),U(t.date)},onDoubleClick:N=>N.stopPropagation(),title:"Click để xem tất cả công việc",children:["+",p.length-4," more"]})]})]},a)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{children:"Urgent"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),e.jsx("span",{children:"High"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),e.jsx("span",{children:"Medium"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{children:"Low"})]})]}),u&&e.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:u.x,top:u.y},onClick:t=>t.stopPropagation(),children:[e.jsxs("button",{onClick:()=>G(u.task),className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx(W,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Hoàn thành"})]}),e.jsxs("button",{onClick:()=>{m(u.task),h(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{children:"Chỉnh sửa"})]})]}),r&&e.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:r.x,top:r.y},onClick:t=>t.stopPropagation(),children:[e.jsxs("button",{onClick:()=>{G(r.task),o(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx(W,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Hoàn thành"})]}),e.jsxs("button",{onClick:()=>{m(r.task),o(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{children:"Chỉnh sửa"})]})]}),x&&e.jsx(we,{task:x,onClose:()=>m(null),onSuccess:()=>m(null)}),e.jsx(Ee,{isOpen:K,onClose:()=>O(!1),selectedDate:z,tasks:H})]})};export{Ue as D};
