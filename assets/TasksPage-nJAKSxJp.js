import{r as l,u as E,h as y,f as v,i as F,k as L,j as e,q as R,t as D,F as $,m as O,P as o,T as i,L as P,p as I}from"./index-CJ5UhWEA.js";import{F as G,T as k}from"./TaskForm-IOGDTt5T.js";function M({title:s,titleId:a,...n},c){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":a},n),s?l.createElement("title",{id:a},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z"}))}const A=l.forwardRef(M);function B({title:s,titleId:a,...n},c){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":a},n),s?l.createElement("title",{id:a},s):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))}const H=l.forwardRef(B);function U({title:s,titleId:a,...n},c){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":a},n),s?l.createElement("title",{id:a},s):null,l.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12Zm13.36-1.814a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}))}const Q=l.forwardRef(U),W=({task:s})=>{const{user:a}=E(),{toggleTaskCompletion:n,deleteTask:c}=y(),{getGroupById:h,getDefaultGroup:p}=v(),[b,m]=l.useState(!1),[j,u]=l.useState(!1),{confirm:w,ConfirmComponent:r}=F(),{showToast:t}=L(),d=s.groupId?h(s.groupId):p(),g=x=>{switch(x){case o.URGENT:return"text-red-600 bg-red-100 border-red-200";case o.HIGH:return"text-orange-600 bg-orange-100 border-orange-200";case o.MEDIUM:return"text-yellow-600 bg-yellow-100 border-yellow-200";case o.LOW:return"text-green-600 bg-green-100 border-green-200";default:return"text-gray-600 bg-gray-100 border-gray-200"}},C=x=>{switch(x){case i.COMPLETED:return"text-green-600 bg-green-100";case i.IN_PROGRESS:return"text-blue-600 bg-blue-100";case i.TODO:return"text-gray-600 bg-gray-100";case i.CANCELLED:return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},f=s.dueDate&&s.dueDate<new Date&&!s.isCompleted,S=async()=>{if(!a)return;m(!0);const x=!s.isCompleted;console.log("🔄 Toggling task completion:",{taskId:s.id,title:s.title,currentState:s.isCompleted,newState:x,isOverdue:f,dueDate:s.dueDate,status:s.status});try{await n(a.uid,s.id,x),t(s.isCompleted?"Đã đánh dấu task chưa hoàn thành":"Đã hoàn thành task!","success")}catch(N){console.error("❌ Error toggling task completion:",N),t(`Có lỗi xảy ra: ${N.message}`,"error")}finally{m(!1)}},T=()=>{a&&w("Xóa task",`Bạn có chắc chắn muốn xóa task "${s.title}"?`,async()=>{m(!0);try{await c(a.uid,s.id),t("Đã xóa task thành công","success")}catch{t("Có lỗi xảy ra khi xóa task","error")}finally{m(!1)}},"danger","Xóa task")};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 p-6 ${s.isCompleted?"border-green-500":f?"border-red-500":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("button",{onClick:S,disabled:b,className:"mt-1 text-gray-400 hover:text-green-600 transition-colors","aria-label":s.isCompleted?"Đánh dấu chưa hoàn thành":"Đánh dấu hoàn thành",children:s.isCompleted?e.jsx(Q,{className:"w-6 h-6 text-green-600"}):e.jsx(R,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`text-lg font-medium ${s.isCompleted?"text-gray-500 line-through":"text-gray-900 dark:text-white"}`,children:s.title}),s.description&&e.jsx("p",{className:`mt-1 text-sm ${s.isCompleted?"text-gray-400":"text-gray-600 dark:text-gray-300"}`,children:s.description}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${g(s.priority)}`,children:s.priority}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${C(s.status)}`,children:s.status.replace("-"," ")}),s.dueDate&&e.jsxs("div",{className:`flex items-center text-xs ${f?"text-red-600":"text-gray-500"}`,children:[f&&e.jsx(D,{className:"w-4 h-4 mr-1"}),e.jsx(G,{className:"w-4 h-4 mr-1"}),"Due: ",s.dueDate.toLocaleDateString()]}),d&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("span",{className:"mr-1",children:d.icon}),e.jsx("span",{children:d.name})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>u(!0),className:"text-gray-400 hover:text-blue-600 transition-colors","aria-label":"Chỉnh sửa task",children:e.jsx($,{className:"w-5 h-5"})}),e.jsx("button",{onClick:T,disabled:b,className:"text-gray-400 hover:text-red-600 transition-colors","aria-label":"Xóa task",children:e.jsx(O,{className:"w-5 h-5"})})]})]}),j&&e.jsx(k,{task:s,onClose:()=>u(!1),onSuccess:()=>{u(!1),t("Cập nhật task thành công","success")}}),e.jsx(r,{})]})},Z=()=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 border-gray-300 p-6 animate-pulse",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full mb-1"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-16"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-20"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-24"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})]})]})}),X=({count:s=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:s}).map((a,n)=>e.jsx(Z,{},n))}),_=()=>{const{getFilteredTasks:s,loading:a}=y(),n=s();return a?e.jsx(X,{count:5}):n.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Không tìm thấy task nào. Tạo task đầu tiên để bắt đầu!"})}):e.jsx("div",{className:"space-y-4",children:n.map(c=>e.jsx(W,{task:c},c.id))})},q=()=>{const{filters:s,setFilters:a}=y(),{fetchGroups:n}=v(),[c,h]=l.useState(s.searchQuery||"");l.useEffect(()=>{n()},[n]);const p=r=>{const t=s.status||[],d=t.includes(r)?t.filter(g=>g!==r):[...t,r];a({...s,status:d})},b=r=>{const t=s.priority||[],d=t.includes(r)?t.filter(g=>g!==r):[...t,r];a({...s,priority:d})},m=r=>{h(r),a({...s,searchQuery:r||void 0})},j=()=>{a({}),h("")},u=[{value:i.TODO,label:"To Do",color:"bg-gray-100 text-gray-800"},{value:i.IN_PROGRESS,label:"In Progress",color:"bg-blue-100 text-blue-800"},{value:i.COMPLETED,label:"Completed",color:"bg-green-100 text-green-800"},{value:i.CANCELLED,label:"Cancelled",color:"bg-red-100 text-red-800"}],w=[{value:o.LOW,label:"Low",color:"bg-green-100 text-green-800"},{value:o.MEDIUM,label:"Medium",color:"bg-yellow-100 text-yellow-800"},{value:o.HIGH,label:"High",color:"bg-orange-100 text-orange-800"},{value:o.URGENT,label:"Urgent",color:"bg-red-100 text-red-800"}];return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(A,{className:"w-5 h-5 mr-2"}),"Filters"]}),e.jsx("button",{onClick:j,className:"text-sm text-primary-600 hover:text-primary-700",children:"Clear all"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tasks...",value:c,onChange:r=>m(r.target.value),className:"input-field pl-10"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Status"}),e.jsx("div",{className:"space-y-2",children:u.map(r=>{var t;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((t=s.status)==null?void 0:t.includes(r.value))||!1,onChange:()=>p(r.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${r.color}`,children:r.label})]},r.value)})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Priority"}),e.jsx("div",{className:"space-y-2",children:w.map(r=>{var t;return e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:((t=s.priority)==null?void 0:t.includes(r.value))||!1,onChange:()=>b(r.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${r.color}`,children:r.label})]},r.value)})})]})]})},V=()=>{const{loading:s,fetchTasks:a}=y(),[n,c]=l.useState(!1);return l.useEffect(()=>{a()},[a]),s?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(P,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Tasks"}),e.jsxs("button",{onClick:()=>c(!0),className:"btn-primary flex items-center",children:[e.jsx(I,{className:"w-5 h-5 mr-2"}),"New Task"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(q,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(_,{})})]}),n&&e.jsx(k,{onClose:()=>c(!1),onSuccess:()=>c(!1)})]})};export{V as default};
