import{r as b,j as e,l as L,c as F,a as M,m as P,d as R,e as $,n as G,p as H,k as U}from"./vendor-C0uaCzFa.js";import{a as k,u as D,c as S,T as i,P as o,M as _,b as A}from"./calendar-06gnfMXl.js";import{u as E,L as O,a as C}from"./auth-DbZI5HnD.js";const I=({task:t,onClose:l,onSuccess:x})=>{const{user:n}=E(),{createTask:N,updateTask:v}=k(),{groups:j,fetchGroups:h,getDefaultGroup:w}=D(),[p,s]=b.useState(!1),[m,c]=b.useState(""),{showToast:g}=S(),[r,T]=b.useState({title:t?.title||"",description:t?.description||"",startDate:t?.startDate?t.startDate.toISOString().split("T")[0]:new Date().toISOString().split("T")[0],dueDate:t?.dueDate?t.dueDate.toISOString().split("T")[0]:"",priority:t?.priority||o.MEDIUM,status:t?.status||i.TODO,groupId:t?.groupId||""});b.useEffect(()=>{j.length===0&&h()},[h,j.length]);const f=async a=>{if(a.preventDefault(),!n){c("User not authenticated");return}s(!0),c("");try{const d=w(),u={title:r.title.trim(),description:r.description.trim()||void 0,startDate:r.startDate?new Date(r.startDate):new Date,dueDate:r.dueDate?new Date(r.dueDate):void 0,priority:r.priority,status:r.status,groupId:r.groupId||d.id,isCompleted:r.status===i.COMPLETED,completedAt:r.status===i.COMPLETED?new Date:void 0};C("Task data prepared",u),t?(C("Updating existing task",t.id),await v(n.uid,t.id,u)):(C("Creating new task for user",n.uid),await N(n.uid,u)),C("Task operation completed successfully"),g(t?"Cập nhật task thành công":"Tạo task thành công","success"),x?.(),l()}catch(d){const u=d.message||"Có lỗi xảy ra";c(u),g(u,"error")}finally{s(!1)}},y=(a,d)=>{T(u=>({...u,[a]:d}))};return e.jsx(_,{isOpen:!0,onClose:l,title:t?"Chỉnh sửa Task":"Tạo Task mới",className:"max-w-4xl",children:e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[m&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:m}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tiêu đề *"}),e.jsx("input",{type:"text",required:!0,value:r.title,onChange:a=>y("title",a.target.value),className:"input-field",placeholder:"Nhập tiêu đề task",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.title.length,"/200 ký tự"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Mô tả"}),e.jsx("textarea",{value:r.description,onChange:a=>y("description",a.target.value),className:"input-field",rows:2,placeholder:"Nhập mô tả task",maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.description.length,"/1000 ký tự"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ngày bắt đầu"}),e.jsx("input",{type:"date",value:r.startDate,onChange:a=>y("startDate",a.target.value),className:"input-field"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày bắt đầu thực hiện"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hạn hoàn thành"}),e.jsx("input",{type:"date",value:r.dueDate,onChange:a=>y("dueDate",a.target.value),className:"input-field",min:r.startDate||void 0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày cần hoàn thành"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Độ ưu tiên"}),e.jsxs("select",{value:r.priority,onChange:a=>y("priority",a.target.value),className:"input-field",children:[e.jsx("option",{value:o.LOW,children:"🟢 Thấp"}),e.jsx("option",{value:o.MEDIUM,children:"🟡 Trung bình"}),e.jsx("option",{value:o.HIGH,children:"🟠 Cao"}),e.jsx("option",{value:o.URGENT,children:"🔴 Khẩn cấp"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Mức độ quan trọng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trạng thái"}),e.jsxs("select",{value:r.status,onChange:a=>y("status",a.target.value),className:"input-field",children:[e.jsx("option",{value:i.TODO,children:"📝 Chưa làm"}),e.jsx("option",{value:i.IN_PROGRESS,children:"⚡ Đang làm"}),e.jsx("option",{value:i.COMPLETED,children:"✅ Hoàn thành"}),e.jsx("option",{value:i.CANCELLED,children:"❌ Đã hủy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Tình trạng hiện tại"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nhóm"}),e.jsxs("select",{value:r.groupId,onChange:a=>y("groupId",a.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"📋 Nhóm mặc định"}),j.filter(a=>a.name!=="Default"&&a.name!=="Nhóm mặc định").map(a=>e.jsxs("option",{value:a.id,children:[a.icon," ",a.name]},a.id))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Phân loại task theo nhóm"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",disabled:p,children:"Hủy"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:p||!r.title.trim(),children:p?e.jsx(O,{size:"sm"}):t?"Cập nhật Task":"Tạo Task"})]})]})})},Q=({task:t})=>{const{user:l}=E(),{toggleTaskCompletion:x,deleteTask:n}=k(),{getGroupById:N,getDefaultGroup:v}=D(),[j,h]=b.useState(!1),[w,p]=b.useState(!1),{confirm:s,ConfirmComponent:m}=A(),{showToast:c}=S(),g=t.groupId?N(t.groupId):v(),r=d=>{switch(d){case o.URGENT:return"text-red-600 bg-red-100 border-red-200";case o.HIGH:return"text-orange-600 bg-orange-100 border-orange-200";case o.MEDIUM:return"text-yellow-600 bg-yellow-100 border-yellow-200";case o.LOW:return"text-green-600 bg-green-100 border-green-200";default:return"text-gray-600 bg-gray-100 border-gray-200"}},T=d=>{switch(d){case i.COMPLETED:return"text-green-600 bg-green-100";case i.IN_PROGRESS:return"text-blue-600 bg-blue-100";case i.TODO:return"text-gray-600 bg-gray-100";case i.CANCELLED:return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},f=t.dueDate&&t.dueDate<new Date&&!t.isCompleted,y=async()=>{if(!l)return;h(!0);const d=!t.isCompleted;console.log("🔄 Toggling task completion:",{taskId:t.id,title:t.title,currentState:t.isCompleted,newState:d,isOverdue:f,dueDate:t.dueDate,status:t.status});try{await x(l.uid,t.id,d),c(t.isCompleted?"Đã đánh dấu task chưa hoàn thành":"Đã hoàn thành task!","success")}catch(u){console.error("❌ Error toggling task completion:",u),c(`Có lỗi xảy ra: ${u.message}`,"error")}finally{h(!1)}},a=()=>{l&&s("Xóa task",`Bạn có chắc chắn muốn xóa task "${t.title}"?`,async()=>{h(!0);try{await n(l.uid,t.id),c("Đã xóa task thành công","success")}catch{c("Có lỗi xảy ra khi xóa task","error")}finally{h(!1)}},"danger","Xóa task")};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 p-6 ${t.isCompleted?"border-green-500":f?"border-red-500":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("button",{onClick:y,disabled:j,className:"mt-1 text-gray-400 hover:text-green-600 transition-colors","aria-label":t.isCompleted?"Đánh dấu chưa hoàn thành":"Đánh dấu hoàn thành",children:t.isCompleted?e.jsx(L,{className:"w-6 h-6 text-green-600"}):e.jsx(F,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`text-lg font-medium ${t.isCompleted?"text-gray-500 line-through":"text-gray-900 dark:text-white"}`,children:t.title}),t.description&&e.jsx("p",{className:`mt-1 text-sm ${t.isCompleted?"text-gray-400":"text-gray-600 dark:text-gray-300"}`,children:t.description}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${r(t.priority)}`,children:t.priority}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${T(t.status)}`,children:t.status.replace("-"," ")}),t.dueDate&&e.jsxs("div",{className:`flex items-center text-xs ${f?"text-red-600":"text-gray-500"}`,children:[f&&e.jsx(M,{className:"w-4 h-4 mr-1"}),e.jsx(P,{className:"w-4 h-4 mr-1"}),"Due: ",t.dueDate.toLocaleDateString()]}),g&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("span",{className:"mr-1",children:g.icon}),e.jsx("span",{children:g.name})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>p(!0),className:"text-gray-400 hover:text-blue-600 transition-colors","aria-label":"Chỉnh sửa task",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("button",{onClick:a,disabled:j,className:"text-gray-400 hover:text-red-600 transition-colors","aria-label":"Xóa task",children:e.jsx($,{className:"w-5 h-5"})})]})]}),w&&e.jsx(I,{task:t,onClose:()=>p(!1),onSuccess:()=>{p(!1),c("Cập nhật task thành công","success")}}),e.jsx(m,{})]})},z=()=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 border-gray-300 p-6 animate-pulse",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full mb-1"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-16"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-20"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-24"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})]})]})}),W=({count:t=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:t}).map((l,x)=>e.jsx(z,{},x))}),X=()=>{const{getFilteredTasks:t,loading:l}=k(),x=t();return l?e.jsx(W,{count:5}):x.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Không tìm thấy task nào. Tạo task đầu tiên để bắt đầu!"})}):e.jsx("div",{className:"space-y-4",children:x.map(n=>e.jsx(Q,{task:n},n.id))})},q=()=>{const{filters:t,setFilters:l}=k(),[x,n]=b.useState(t.searchQuery||""),N=s=>{const m=t.status||[],c=m.includes(s)?m.filter(g=>g!==s):[...m,s];l({...t,status:c})},v=s=>{const m=t.priority||[],c=m.includes(s)?m.filter(g=>g!==s):[...m,s];l({...t,priority:c})},j=s=>{n(s),l({...t,searchQuery:s||void 0})},h=()=>{l({}),n("")},w=[{value:i.TODO,label:"To Do",color:"bg-gray-100 text-gray-800"},{value:i.IN_PROGRESS,label:"In Progress",color:"bg-blue-100 text-blue-800"},{value:i.COMPLETED,label:"Completed",color:"bg-green-100 text-green-800"},{value:i.CANCELLED,label:"Cancelled",color:"bg-red-100 text-red-800"}],p=[{value:o.LOW,label:"Low",color:"bg-green-100 text-green-800"},{value:o.MEDIUM,label:"Medium",color:"bg-yellow-100 text-yellow-800"},{value:o.HIGH,label:"High",color:"bg-orange-100 text-orange-800"},{value:o.URGENT,label:"Urgent",color:"bg-red-100 text-red-800"}];return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Filters"]}),e.jsx("button",{onClick:h,className:"text-sm text-primary-600 hover:text-primary-700",children:"Clear all"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tasks...",value:x,onChange:s=>j(s.target.value),className:"input-field pl-10"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Status"}),e.jsx("div",{className:"space-y-2",children:w.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.status?.includes(s.value)||!1,onChange:()=>N(s.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:s.label})]},s.value))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Priority"}),e.jsx("div",{className:"space-y-2",children:p.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.priority?.includes(s.value)||!1,onChange:()=>v(s.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:s.label})]},s.value))})]})]})},B=()=>{const{loading:t,fetchTasks:l}=k(),[x,n]=b.useState(!1);return b.useEffect(()=>{l()},[l]),t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(O,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Tasks"}),e.jsxs("button",{onClick:()=>n(!0),className:"btn-primary flex items-center",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"New Task"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(q,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(X,{})})]}),x&&e.jsx(I,{onClose:()=>n(!1),onSuccess:()=>n(!1)})]})},Y=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{I as T,Y as a};
