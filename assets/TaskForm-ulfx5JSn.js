import{u as E,h as I,m as L,r as c,p as M,T as n,P as d,j as e,M as O,L as S,w as x}from"./index-CMJAelHt.js";const G=({task:t,onClose:u,onSuccess:m})=>{const{user:o}=E(),{createTask:b,updateTask:v}=I(),{groups:f,fetchGroups:g,getDefaultGroup:D}=L(),[h,y]=c.useState(!1),[j,p]=c.useState(""),{showToast:N}=M(),[s,T]=c.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",startDate:t!=null&&t.startDate?t.startDate.toISOString().split("T")[0]:"",dueDate:t!=null&&t.dueDate?t.dueDate.toISOString().split("T")[0]:"",priority:(t==null?void 0:t.priority)||d.MEDIUM,status:(t==null?void 0:t.status)||n.TODO,groupId:(t==null?void 0:t.groupId)||""});c.useEffect(()=>{g()},[g]);const C=async a=>{if(a.preventDefault(),!o){p("User not authenticated");return}y(!0),p("");try{const l=D(),r={title:s.title.trim(),description:s.description.trim()||void 0,startDate:s.startDate?new Date(s.startDate):void 0,dueDate:s.dueDate?new Date(s.dueDate):void 0,priority:s.priority,status:s.status,groupId:s.groupId||l.id,isCompleted:s.status===n.COMPLETED,completedAt:s.status===n.COMPLETED?new Date:void 0};x("Task data prepared",r),t?(x("Updating existing task",t.id),await v(o.uid,t.id,r)):(x("Creating new task for user",o.uid),await b(o.uid,r)),x("Task operation completed successfully"),N(t?"C·∫≠p nh·∫≠t task th√†nh c√¥ng":"T·∫°o task th√†nh c√¥ng","success"),m==null||m(),u()}catch(l){const r=l.message||"C√≥ l·ªói x·∫£y ra";p(r),N(r,"error")}finally{y(!1)}},i=(a,l)=>{T(r=>({...r,[a]:l}))};return e.jsx(O,{isOpen:!0,onClose:u,title:t?"Ch·ªânh s·ª≠a Task":"T·∫°o Task m·ªõi",className:"max-w-4xl",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[j&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:j}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ti√™u ƒë·ªÅ *"}),e.jsx("input",{type:"text",required:!0,value:s.title,onChange:a=>i("title",a.target.value),className:"input-field",placeholder:"Nh·∫≠p ti√™u ƒë·ªÅ task",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s.title.length,"/200 k√Ω t·ª±"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"M√¥ t·∫£"}),e.jsx("textarea",{value:s.description,onChange:a=>i("description",a.target.value),className:"input-field",rows:2,placeholder:"Nh·∫≠p m√¥ t·∫£ task",maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s.description.length,"/1000 k√Ω t·ª±"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ng√†y b·∫Øt ƒë·∫ßu"}),e.jsx("input",{type:"date",value:s.startDate,onChange:a=>i("startDate",a.target.value),className:"input-field"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ng√†y b·∫Øt ƒë·∫ßu th·ª±c hi·ªán"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"H·∫°n ho√†n th√†nh"}),e.jsx("input",{type:"date",value:s.dueDate,onChange:a=>i("dueDate",a.target.value),className:"input-field",min:s.startDate||void 0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ng√†y c·∫ßn ho√†n th√†nh"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ƒê·ªô ∆∞u ti√™n"}),e.jsxs("select",{value:s.priority,onChange:a=>i("priority",a.target.value),className:"input-field",children:[e.jsx("option",{value:d.LOW,children:"üü¢ Th·∫•p"}),e.jsx("option",{value:d.MEDIUM,children:"üü° Trung b√¨nh"}),e.jsx("option",{value:d.HIGH,children:"üü† Cao"}),e.jsx("option",{value:d.URGENT,children:"üî¥ Kh·∫©n c·∫•p"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"M·ª©c ƒë·ªô quan tr·ªçng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tr·∫°ng th√°i"}),e.jsxs("select",{value:s.status,onChange:a=>i("status",a.target.value),className:"input-field",children:[e.jsx("option",{value:n.TODO,children:"üìù Ch∆∞a l√†m"}),e.jsx("option",{value:n.IN_PROGRESS,children:"‚ö° ƒêang l√†m"}),e.jsx("option",{value:n.COMPLETED,children:"‚úÖ Ho√†n th√†nh"}),e.jsx("option",{value:n.CANCELLED,children:"‚ùå ƒê√£ h·ªßy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"T√¨nh tr·∫°ng hi·ªán t·∫°i"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nh√≥m"}),e.jsxs("select",{value:s.groupId,onChange:a=>i("groupId",a.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"üìã Nh√≥m m·∫∑c ƒë·ªãnh"}),f.filter(a=>a.name!=="Default"&&a.name!=="Nh√≥m m·∫∑c ƒë·ªãnh").map(a=>e.jsxs("option",{value:a.id,children:[a.icon," ",a.name]},a.id))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ph√¢n lo·∫°i task theo nh√≥m"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:u,className:"btn-secondary",disabled:h,children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:h||!s.title.trim(),children:h?e.jsx(S,{size:"sm"}):t?"C·∫≠p nh·∫≠t Task":"T·∫°o Task"})]})]})})};export{G as T};
