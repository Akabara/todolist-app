import{r as i,u as E,h as w,f as L,p as M,T as l,P as x,j as e,M as O,L as I,v as m}from"./index-CNUvxNne.js";function S({title:t,titleId:d,...c},o){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":d},c),t?i.createElement("title",{id:d},t):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const G=i.forwardRef(S),P=({task:t,onClose:d,onSuccess:c})=>{const{user:o}=E(),{createTask:b,updateTask:N}=w(),{groups:f,fetchGroups:g,getDefaultGroup:D}=L(),[h,y]=i.useState(!1),[j,p]=i.useState(""),{showToast:v}=M(),[s,T]=i.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",startDate:t!=null&&t.startDate?t.startDate.toISOString().split("T")[0]:"",dueDate:t!=null&&t.dueDate?t.dueDate.toISOString().split("T")[0]:"",priority:(t==null?void 0:t.priority)||x.MEDIUM,status:(t==null?void 0:t.status)||l.TODO,groupId:(t==null?void 0:t.groupId)||""});i.useEffect(()=>{g()},[g]);const C=async a=>{if(a.preventDefault(),!o){p("User not authenticated");return}y(!0),p("");try{const u=D(),r={title:s.title.trim(),description:s.description.trim()||void 0,startDate:s.startDate?new Date(s.startDate):void 0,dueDate:s.dueDate?new Date(s.dueDate):void 0,priority:s.priority,status:s.status,groupId:s.groupId||u.id,isCompleted:s.status===l.COMPLETED,completedAt:s.status===l.COMPLETED?new Date:void 0};m("Task data prepared",r),t?(m("Updating existing task",t.id),await N(o.uid,t.id,r)):(m("Creating new task for user",o.uid),await b(o.uid,r)),m("Task operation completed successfully"),v(t?"C·∫≠p nh·∫≠t task th√†nh c√¥ng":"T·∫°o task th√†nh c√¥ng","success"),c==null||c(),d()}catch(u){const r=u.message||"C√≥ l·ªói x·∫£y ra";p(r),v(r,"error")}finally{y(!1)}},n=(a,u)=>{T(r=>({...r,[a]:u}))};return e.jsx(O,{isOpen:!0,onClose:d,title:t?"Ch·ªânh s·ª≠a Task":"T·∫°o Task m·ªõi",className:"max-w-4xl",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[j&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:j}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ti√™u ƒë·ªÅ *"}),e.jsx("input",{type:"text",required:!0,value:s.title,onChange:a=>n("title",a.target.value),className:"input-field",placeholder:"Nh·∫≠p ti√™u ƒë·ªÅ task",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s.title.length,"/200 k√Ω t·ª±"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"M√¥ t·∫£"}),e.jsx("textarea",{value:s.description,onChange:a=>n("description",a.target.value),className:"input-field",rows:2,placeholder:"Nh·∫≠p m√¥ t·∫£ task",maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[s.description.length,"/1000 k√Ω t·ª±"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ng√†y b·∫Øt ƒë·∫ßu"}),e.jsx("input",{type:"date",value:s.startDate,onChange:a=>n("startDate",a.target.value),className:"input-field"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ng√†y b·∫Øt ƒë·∫ßu th·ª±c hi·ªán"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"H·∫°n ho√†n th√†nh"}),e.jsx("input",{type:"date",value:s.dueDate,onChange:a=>n("dueDate",a.target.value),className:"input-field",min:s.startDate||void 0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ng√†y c·∫ßn ho√†n th√†nh"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ƒê·ªô ∆∞u ti√™n"}),e.jsxs("select",{value:s.priority,onChange:a=>n("priority",a.target.value),className:"input-field",children:[e.jsx("option",{value:x.LOW,children:"üü¢ Th·∫•p"}),e.jsx("option",{value:x.MEDIUM,children:"üü° Trung b√¨nh"}),e.jsx("option",{value:x.HIGH,children:"üü† Cao"}),e.jsx("option",{value:x.URGENT,children:"üî¥ Kh·∫©n c·∫•p"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"M·ª©c ƒë·ªô quan tr·ªçng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tr·∫°ng th√°i"}),e.jsxs("select",{value:s.status,onChange:a=>n("status",a.target.value),className:"input-field",children:[e.jsx("option",{value:l.TODO,children:"üìù Ch∆∞a l√†m"}),e.jsx("option",{value:l.IN_PROGRESS,children:"‚ö° ƒêang l√†m"}),e.jsx("option",{value:l.COMPLETED,children:"‚úÖ Ho√†n th√†nh"}),e.jsx("option",{value:l.CANCELLED,children:"‚ùå ƒê√£ h·ªßy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"T√¨nh tr·∫°ng hi·ªán t·∫°i"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nh√≥m"}),e.jsxs("select",{value:s.groupId,onChange:a=>n("groupId",a.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"üìã Nh√≥m m·∫∑c ƒë·ªãnh"}),f.filter(a=>a.name!=="Default"&&a.name!=="Nh√≥m m·∫∑c ƒë·ªãnh").map(a=>e.jsxs("option",{value:a.id,children:[a.icon," ",a.name]},a.id))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ph√¢n lo·∫°i task theo nh√≥m"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:d,className:"btn-secondary",disabled:h,children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:h||!s.title.trim(),children:h?e.jsx(I,{size:"sm"}):t?"C·∫≠p nh·∫≠t Task":"T·∫°o Task"})]})]})})};export{G as F,P as T};
