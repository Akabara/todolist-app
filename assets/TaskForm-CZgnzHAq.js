import{r as i,u as E,i as w,h as L,q as M,T as l,P as x,j as e,M as O,L as I,w as m}from"./index-juksyy78.js";function S({title:t,titleId:d,...c},o){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":d},c),t?i.createElement("title",{id:d},t):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const G=i.forwardRef(S),P=({task:t,onClose:d,onSuccess:c})=>{const{user:o}=E(),{createTask:b,updateTask:f}=w(),{groups:N,fetchGroups:g,getDefaultGroup:D}=L(),[h,y]=i.useState(!1),[j,p]=i.useState(""),{showToast:v}=M(),[a,T]=i.useState({title:(t==null?void 0:t.title)||"",description:(t==null?void 0:t.description)||"",startDate:t!=null&&t.startDate?t.startDate.toISOString().split("T")[0]:"",dueDate:t!=null&&t.dueDate?t.dueDate.toISOString().split("T")[0]:"",priority:(t==null?void 0:t.priority)||x.MEDIUM,status:(t==null?void 0:t.status)||l.TODO,groupId:(t==null?void 0:t.groupId)||""});i.useEffect(()=>{g()},[g]);const C=async s=>{if(s.preventDefault(),!o){p("User not authenticated");return}y(!0),p("");try{const u=D(),r={title:a.title.trim(),description:a.description.trim()||void 0,startDate:a.startDate?new Date(a.startDate):void 0,dueDate:a.dueDate?new Date(a.dueDate):void 0,priority:a.priority,status:a.status,groupId:a.groupId||u.id,isCompleted:a.status===l.COMPLETED,completedAt:a.status===l.COMPLETED?new Date:void 0};m("Task data prepared",r),t?(m("Updating existing task",t.id),await f(o.uid,t.id,r)):(m("Creating new task for user",o.uid),await b(o.uid,r)),m("Task operation completed successfully"),v(t?"Cập nhật task thành công":"Tạo task thành công","success"),c==null||c(),d()}catch(u){const r=u.message||"Có lỗi xảy ra";p(r),v(r,"error")}finally{y(!1)}},n=(s,u)=>{T(r=>({...r,[s]:u}))};return e.jsx(O,{isOpen:!0,onClose:d,title:t?"Chỉnh sửa Task":"Tạo Task mới",className:"max-w-lg",children:e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[j&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:j}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tiêu đề *"}),e.jsx("input",{type:"text",required:!0,value:a.title,onChange:s=>n("title",s.target.value),className:"input-field",placeholder:"Nhập tiêu đề task",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.title.length,"/200 ký tự"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Mô tả"}),e.jsx("textarea",{value:a.description,onChange:s=>n("description",s.target.value),className:"input-field",rows:3,placeholder:"Nhập mô tả task",maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.description.length,"/1000 ký tự"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ngày bắt đầu"}),e.jsx("input",{type:"date",value:a.startDate,onChange:s=>n("startDate",s.target.value),className:"input-field"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày bắt đầu thực hiện task"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hạn hoàn thành"}),e.jsx("input",{type:"date",value:a.dueDate,onChange:s=>n("dueDate",s.target.value),className:"input-field",min:a.startDate||void 0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày cần hoàn thành task"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Độ ưu tiên"}),e.jsxs("select",{value:a.priority,onChange:s=>n("priority",s.target.value),className:"input-field",children:[e.jsx("option",{value:x.LOW,children:"Thấp"}),e.jsx("option",{value:x.MEDIUM,children:"Trung bình"}),e.jsx("option",{value:x.HIGH,children:"Cao"}),e.jsx("option",{value:x.URGENT,children:"Khẩn cấp"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Mức độ quan trọng của task"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trạng thái"}),e.jsxs("select",{value:a.status,onChange:s=>n("status",s.target.value),className:"input-field",children:[e.jsx("option",{value:l.TODO,children:"Chưa làm"}),e.jsx("option",{value:l.IN_PROGRESS,children:"Đang làm"}),e.jsx("option",{value:l.COMPLETED,children:"Hoàn thành"}),e.jsx("option",{value:l.CANCELLED,children:"Đã hủy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Tình trạng hiện tại của task"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nhóm"}),e.jsxs("select",{value:a.groupId,onChange:s=>n("groupId",s.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"Nhóm mặc định"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.icon," ",s.name]},s.id))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Phân loại task theo nhóm"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:d,className:"btn-secondary",disabled:h,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:h||!a.title.trim(),children:h?e.jsx(I,{size:"sm"}):t?"Update Task":"Create Task"})]})]})})};export{G as F,P as T};
