import{r as u,j as e,i as $,g as E,k as I,d as T,e as B}from"./vendor-C0uaCzFa.js";import{u as G,M as R,a as L,b as O,c as X}from"./calendar-06gnfMXl.js";import{u as D,L as q}from"./auth-DbZI5HnD.js";const A=({group:s,onClose:i,onSuccess:j})=>{const{user:x}=D(),{createGroup:k,updateGroup:m}=G(),[p,b]=u.useState(!1),[f,l]=u.useState(""),[r,y]=u.useState({name:s?.name||"",color:s?.color||"#3B82F6",icon:s?.icon||"üìÅ"}),N=async a=>{if(a.preventDefault(),!x){l("User not authenticated");return}if(!r.name.trim()){l("Group name is required");return}const c=r.name.trim(),g=s&&(s.name==="Default"||s.name==="Nh√≥m m·∫∑c ƒë·ªãnh");if(!g&&(c==="Default"||c==="Nh√≥m m·∫∑c ƒë·ªãnh")){l('Kh√¥ng th·ªÉ t·∫°o nh√≥m v·ªõi t√™n "Default" ho·∫∑c "Nh√≥m m·∫∑c ƒë·ªãnh". Vui l√≤ng ch·ªçn t√™n kh√°c.');return}if(g&&c!==s.name){l("Kh√¥ng th·ªÉ thay ƒë·ªïi t√™n c·ªßa nh√≥m m·∫∑c ƒë·ªãnh.");return}b(!0),l("");try{const h={name:r.name.trim(),color:r.color,icon:r.icon};s?await m(x.uid,s.id,h):await k(x.uid,h),j?.(),i()}catch(h){l(h.message||"An error occurred")}finally{b(!1)}},d=(a,c)=>{y(g=>({...g,[a]:c}))},v=["üìÅ","üíº","üè†","üéØ","üìö","üí°","üîß","üé®","üèÉ‚Äç‚ôÇÔ∏è","üçï","üéµ","üåü"],w=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#84CC16"];return e.jsx(R,{isOpen:!0,onClose:i,title:s?"Ch·ªânh s·ª≠a Nh√≥m":"T·∫°o Nh√≥m m·ªõi",children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[f&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:f}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Group Name *"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:a=>d("name",a.target.value),className:"input-field",placeholder:"Enter group name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Icon"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:v.map(a=>e.jsx("button",{type:"button",onClick:()=>d("icon",a),className:`p-2 text-lg rounded border-2 transition-colors ${r.icon===a?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:w.map(a=>e.jsx("button",{type:"button",onClick:()=>d("color",a),className:`w-full h-8 rounded border-2 transition-all ${r.color===a?"border-gray-800 scale-110":"border-gray-200 hover:scale-105"}`,style:{backgroundColor:a}},a))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:i,className:"btn-secondary",disabled:p,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:p||!r.name.trim(),children:p?e.jsx(q,{size:"sm"}):s?"Update Group":"Create Group"})]})]})})},U=()=>{const{user:s}=D(),{groups:i,loading:j,fetchGroups:x,deleteGroup:k}=G(),{filters:m,setFilters:p,tasks:b}=L(),[f,l]=u.useState(!0),[r,y]=u.useState(!1),[N,d]=u.useState(null),{confirm:v,ConfirmComponent:w}=O(),{showToast:a}=X();u.useEffect(()=>{i.length===0&&!j&&x()},[x,i.length,j]);const c=t=>b.filter(n=>n.groupId===t).length,g=()=>{const n=i.filter(o=>o.name==="Default"||o.name==="Nh√≥m m·∫∑c ƒë·ªãnh").map(o=>o.id);return b.filter(o=>!o.groupId||n.includes(o.groupId)).length},h=t=>{m.groupId===t?p({...m,groupId:void 0}):p({...m,groupId:t||void 0})},F=async t=>{if(!s)return;const n=i.find(C=>C.id===t),o=c(t);v("X√≥a nh√≥m",`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√≥m "${n?.name}"? ${o>0?`${o} task(s) s·∫Ω ƒë∆∞·ª£c chuy·ªÉn v·ªÅ nh√≥m Default.`:""}`,async()=>{try{await k(s.uid,t),a(`ƒê√£ x√≥a nh√≥m "${n?.name}" th√†nh c√¥ng`,"success")}catch{a("C√≥ l·ªói x·∫£y ra khi x√≥a nh√≥m","error")}},"danger","X√≥a nh√≥m")},S=t=>{d(t),y(!0)};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>l(!f),className:"flex items-center text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:[f?e.jsx($,{className:"w-4 h-4 mr-1"}):e.jsx(E,{className:"w-4 h-4 mr-1"}),"Groups"]}),e.jsx("button",{onClick:()=>y(!0),className:"text-gray-400 hover:text-primary-600","aria-label":"Th√™m nh√≥m m·ªõi",children:e.jsx(I,{className:"w-4 h-4"})})]}),f&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>h(null),className:`w-full flex items-center justify-between px-2 py-1.5 text-sm rounded-md transition-colors ${m.groupId===void 0?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-white"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-xs",children:"üìã"}),e.jsx("span",{className:"text-xs",children:"Default"})]}),e.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:g()})]}),i.filter(t=>t.name!=="Default"&&t.name!=="Nh√≥m m·∫∑c ƒë·ªãnh").map(t=>e.jsxs("div",{className:"group relative",children:[e.jsxs("button",{onClick:()=>h(t.id),className:`w-full flex items-center justify-between px-2 py-1.5 text-sm rounded-md transition-colors ${m.groupId===t.id?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-white"}`,children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx("span",{className:"mr-2 text-xs",children:t.icon}),e.jsx("span",{className:"text-xs truncate",children:t.name})]}),e.jsx("div",{className:"flex items-center space-x-1 ml-2",children:e.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:c(t.id)})})]}),!(t.name==="Default"||t.name==="Nh√≥m m·∫∑c ƒë·ªãnh")&&e.jsxs("div",{className:"absolute right-8 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-0.5 bg-white dark:bg-gray-800 rounded shadow-sm",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),S(t)},className:"p-1 text-gray-400 hover:text-blue-600 rounded","aria-label":`Ch·ªânh s·ª≠a nh√≥m ${t.name}`,children:e.jsx(T,{className:"w-3 h-3"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),F(t.id)},className:"p-1 text-gray-400 hover:text-red-600 rounded","aria-label":`X√≥a nh√≥m ${t.name}`,children:e.jsx(B,{className:"w-3 h-3"})})]})]},t.id))]}),r&&e.jsx(A,{group:N,onClose:()=>{y(!1),d(null)},onSuccess:()=>{y(!1),d(null),a(N?"C·∫≠p nh·∫≠t nh√≥m th√†nh c√¥ng":"T·∫°o nh√≥m th√†nh c√¥ng","success")}}),e.jsx(w,{})]})};export{U as G};
