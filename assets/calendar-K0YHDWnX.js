import{r as k,j as r,F as Ke,a as Ve,b as ie,c as qe,d as Xe,e as Qe,f as Je,g as Ye,h as le}from"./react-vendor-pFVYdC-7.js";import{c as ue}from"./state-vendor-BmQXea_b.js";import{d as q,e as ce,f as W,h as _e,j as G,k as ge,l as he,q as M,w as X,m as Ze,o as ee,n as re,T as $,p as er}from"./firebase-vendor-B-62f7J8.js";import{d as H,a as g,g as L,b as K,u as J}from"./auth-BoLvIiX1.js";import{T as me}from"./tasks-CEgUBeZK.js";const rr=(a,o)=>{const e=a.data();return{id:a.id,userId:o,...e,createdAt:e.createdAt?.toDate?.()||new Date}};class tr{getGroupsCollection(o){return q(H,"users",o,"groups")}async ensureDefaultGroup(o){try{const e=q(H,"users",o,"groups"),s=await ce(e);for(const n of s.docs){const i=n.data();if(i.name==="Default"||i.name==="Nhóm mặc định")return g("GroupService: Default group already exists",n.id),n.id}const t=W(H,"users",o,"groups","default");return await _e(t,{name:"Default",color:"#6B7280",icon:"📋",createdAt:G(),updatedAt:G()},{merge:!0}),g("GroupService: Created new default group"),"default"}catch(e){throw e}}async createGroup(o,e){try{g("GroupService: Creating group",{userId:o,groupData:e});const s={...e,createdAt:G(),updatedAt:G()};g("GroupService: Firestore data",s);const t=await ge(this.getGroupsCollection(o),s);return g("GroupService: Group created with ID",t.id),{id:t.id,error:null}}catch(s){return{id:null,error:L(s)}}}async updateGroup(o,e,s){try{const t=W(this.getGroupsCollection(o),e),n={...s,updatedAt:G()};return await he(t,n),{error:null}}catch(t){return{error:L(t)}}}async deleteGroup(o,e){if(e==="default")return{error:"Không thể xóa nhóm mặc định"};try{const s=await this.ensureDefaultGroup(o),t=M(q(H,"users",o,"tasks"),X("groupId","==",e)),n=await ce(t),i=Ze(H);n.docs.forEach(u=>{i.update(u.ref,{groupId:s,updatedAt:G()})});const c=W(this.getGroupsCollection(o),e);return i.delete(c),await i.commit(),g("GroupService: Group deleted and tasks moved to default",{groupId:e,tasksCount:n.size}),{error:null}}catch(s){return{error:L(s)}}}subscribeToGroups(o,e){const s=M(this.getGroupsCollection(o),ee("createdAt","asc"));return re(s,t=>{g("GroupService: Received snapshot",{size:t.size,empty:t.empty,changes:t.docChanges().length});const n=t.docs.map(i=>{const c=rr(i,o);return g("GroupService: Converted group",{id:c.id,name:c.name}),c});g("GroupService: Calling callback with groups",n.length),e(n)},t=>{})}}const B=new tr,fe=ue((a,o)=>({groups:[],loading:!1,error:null,unsubscribe:null,setGroups:e=>a({groups:e}),setLoading:e=>a({loading:e}),setError:e=>a({error:e}),setUnsubscribe:e=>a({unsubscribe:e}),fetchGroups:()=>{const{unsubscribe:e}=o();e&&e(),a({loading:!0,error:null});const t=J.getState().user;if(!t){a({loading:!1,error:"User not authenticated"});return}B.ensureDefaultGroup(t.uid).catch(i=>{});const n=B.subscribeToGroups(t.uid,i=>{a({groups:i,loading:!1,error:null})});a({unsubscribe:n})},createGroup:async(e,s)=>{a({loading:!0,error:null});try{const t=await B.createGroup(e,s);if(g("GroupStore: Create group result",t),t.error)throw K("GroupStore: Create group failed",t.error),a({error:t.error,loading:!1}),new Error(t.error);g("GroupStore: Group created successfully",t.id),a({loading:!1})}catch(t){throw a({error:t.message,loading:!1}),t}},updateGroup:async(e,s,t)=>{try{const n=await B.updateGroup(e,s,t);n.error&&a({error:n.error})}catch(n){const i=L(n);a({error:i})}},deleteGroup:async(e,s)=>{try{const t=await B.deleteGroup(e,s);if(t.error)throw a({error:t.error}),new Error(t.error)}catch(t){const n=L(t);throw a({error:n}),t}},getGroupById:e=>{const{groups:s}=o();return s.find(t=>t.id===e)},getDefaultGroup:()=>{const{groups:e}=o();return e.find(s=>s.name==="Default"||s.name==="Nhóm mặc định")||{id:"default",name:"Default",color:"#6B7280",icon:"📋",userId:"",createdAt:new Date}}}));var f=(a=>(a.LOW="low",a.MEDIUM="medium",a.HIGH="high",a.URGENT="urgent",a))(f||{}),Q=(a=>(a.TODO="todo",a.IN_PROGRESS="in-progress",a.COMPLETED="completed",a.CANCELLED="cancelled",a))(Q||{});const de=(a,o)=>{const e=a.data();return{id:a.id,userId:o,...e,startDate:e.startDate?.toDate?.()||null,dueDate:e.dueDate?.toDate?.()||null,createdAt:e.createdAt?.toDate?.()||new Date,updatedAt:e.updatedAt?.toDate?.()||new Date,completedAt:e.completedAt?.toDate?.()||null}};class sr{getTasksCollection(o){return q(H,"users",o,"tasks")}async createTask(o,e){try{g("TaskService: Creating task",{userId:o,taskData:e});const s={...e,startDate:e.startDate?$.fromDate(e.startDate):null,dueDate:e.dueDate?$.fromDate(e.dueDate):null,completedAt:e.completedAt?$.fromDate(e.completedAt):null,createdAt:G(),updatedAt:G()};g("TaskService: Firestore data",s);const t=await ge(this.getTasksCollection(o),s);return g("TaskService: Task created with ID",t.id),{id:t.id,error:null}}catch(s){return{id:null,error:L(s)}}}async updateTask(o,e,s){try{g("TaskService: Updating task",{userId:o,taskId:e,updates:s});const t=W(this.getTasksCollection(o),e),n={};Object.keys(s).forEach(c=>{const u=s[c];u!==void 0&&(n[c]=u)});const i={...n,updatedAt:G()};return s.startDate!==void 0&&(i.startDate=s.startDate?$.fromDate(s.startDate):null),s.dueDate!==void 0&&(i.dueDate=s.dueDate?$.fromDate(s.dueDate):null),s.completedAt!==void 0&&(i.completedAt=s.completedAt?$.fromDate(s.completedAt):null),g("TaskService: Clean update data",i),await he(t,i),g("TaskService: Task updated successfully"),{error:null}}catch(t){return{error:L(t)}}}async deleteTask(o,e){try{const s=W(this.getTasksCollection(o),e);return await er(s),{error:null}}catch(s){return{error:L(s)}}}async toggleTaskCompletion(o,e,s){try{g("TaskService: Toggling task completion",{userId:o,taskId:e,isCompleted:s});const t={isCompleted:s,status:s?Q.COMPLETED:Q.TODO,completedAt:s?new Date:null};g("TaskService: Update data for toggle",t);const n=await this.updateTask(o,e,t);return n.error?K("TaskService: Toggle completion failed",n.error):g("TaskService: Toggle completion successful"),n}catch(t){return{error:L(t)}}}subscribeToTasks(o,e){const s=M(this.getTasksCollection(o),ee("createdAt","desc"));return re(s,t=>{g("TaskService: Received snapshot",{size:t.size,empty:t.empty,changes:t.docChanges().length});const n=t.docs.map(i=>{const c=de(i,o);return g("TaskService: Converted task",{id:c.id,title:c.title}),c});g("TaskService: Calling callback with tasks",n.length),e(n)},t=>{})}subscribeToFilteredTasks(o,e,s){let t=M(this.getTasksCollection(o));return e.status&&e.status.length>0&&(t=M(t,X("status","in",e.status))),e.priority&&e.priority.length>0&&(t=M(t,X("priority","in",e.priority))),e.categoryId&&(t=M(t,X("categoryId","==",e.categoryId))),t=M(t,ee("createdAt","desc")),re(t,n=>{const i=n.docs.map(c=>de(c,o));s(i)})}}const z=new sr,pe=ue((a,o)=>({tasks:[],loading:!1,error:null,filters:{},sort:{field:"createdAt",direction:"desc"},unsubscribe:null,setTasks:e=>a({tasks:e}),setLoading:e=>a({loading:e}),setError:e=>a({error:e}),setFilters:e=>a({filters:e}),setSort:e=>a({sort:e}),setUnsubscribe:e=>a({unsubscribe:e}),fetchTasks:()=>{const{unsubscribe:e}=o();e&&e(),a({loading:!0,error:null});const t=J.getState().user;if(!t){a({loading:!1,error:"User not authenticated"});return}const n=z.subscribeToTasks(t.uid,i=>{a({tasks:i,loading:!1,error:null})});a({unsubscribe:n})},createTask:async(e,s)=>{a({loading:!0,error:null});try{const t=await z.createTask(e,s);if(g("TaskStore: Create task result",t),t.error)throw K("TaskStore: Create task failed",t.error),a({error:t.error,loading:!1}),new Error(t.error);g("TaskStore: Task created successfully",t.id),a({loading:!1})}catch(t){throw a({error:t.message,loading:!1}),t}},updateTask:async(e,s,t)=>{try{g("TaskStore: Updating task",{userId:e,taskId:s,updates:t});const n=await z.updateTask(e,s,t);if(n.error)throw K("TaskStore: Update task failed",n.error),a({error:n.error}),new Error(n.error);g("TaskStore: Update task successful")}catch(n){throw a({error:n.message}),n}},deleteTask:async(e,s)=>{try{const t=await z.deleteTask(e,s);if(t.error)throw a({error:t.error}),new Error(t.error)}catch(t){throw a({error:t.message}),t}},toggleTaskCompletion:async(e,s,t)=>{try{g("TaskStore: Toggling task completion",{taskId:s,isCompleted:t});const n=await z.toggleTaskCompletion(e,s,t);if(n.error)throw K("TaskStore: Toggle completion failed",n.error),a({error:n.error}),new Error(n.error);g("TaskStore: Toggle completion successful")}catch(n){throw a({error:n.message}),n}},getFilteredTasks:()=>{const{tasks:e,filters:s,sort:t}=o();let n=[...e];if(s.status&&s.status.length>0&&(n=n.filter(i=>s.status.includes(i.status))),s.priority&&s.priority.length>0&&(n=n.filter(i=>s.priority.includes(i.priority))),s.groupId&&(n=n.filter(i=>i.groupId===s.groupId)),s.searchQuery){const i=s.searchQuery.toLowerCase();n=n.filter(c=>c.title.toLowerCase().includes(i)||c.description?.toLowerCase().includes(i))}return s.dateRange&&(n=n.filter(i=>i.dueDate?i.dueDate>=s.dateRange.start&&i.dueDate<=s.dateRange.end:!1)),n.sort((i,c)=>{let u,x;switch(t.field){case"dueDate":u=i.dueDate?.getTime()||0,x=c.dueDate?.getTime()||0;break;case"createdAt":u=i.createdAt.getTime(),x=c.createdAt.getTime();break;case"priority":const h={[f.URGENT]:4,[f.HIGH]:3,[f.MEDIUM]:2,[f.LOW]:1};u=h[i.priority],x=h[c.priority];break;case"title":u=i.title.toLowerCase(),x=c.title.toLowerCase();break;default:return 0}return t.direction==="asc"?u>x?1:-1:u<x?1:-1}),n},getTasksByStatus:e=>{const{tasks:s}=o();return s.filter(t=>t.status===e)},getOverdueTasks:()=>{const{tasks:e}=o(),s=new Date;return e.filter(t=>t.dueDate&&t.dueDate<s&&t.status!==Q.COMPLETED)}})),xe=({isOpen:a,onClose:o,title:e,children:s,className:t=""})=>{const n=k.useRef(null),i=k.useRef(null);return k.useEffect(()=>{if(!a)return;const c=n.current;if(!c)return;i.current?.focus();const u=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),x=u[0],h=u[u.length-1],p=b=>{b.key==="Tab"&&(b.shiftKey?document.activeElement===x&&(b.preventDefault(),h?.focus()):document.activeElement===h&&(b.preventDefault(),x?.focus()))},y=b=>{b.key==="Escape"&&o()};return document.addEventListener("keydown",p),document.addEventListener("keydown",y),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",p),document.removeEventListener("keydown",y),document.body.style.overflow="unset"}},[a,o]),a?r.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:o,children:r.jsxs("div",{ref:n,className:`relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-gray-800 ${t}`,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",onClick:c=>c.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsx("h3",{ref:i,id:"modal-title",className:"text-lg font-medium text-gray-900 dark:text-white",tabIndex:-1,children:e}),r.jsx("button",{onClick:o,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"Đóng modal",children:r.jsx(Ke,{className:"w-6 h-6"})})]}),s]})}):null},ar=({isOpen:a,onClose:o,onConfirm:e,title:s,message:t,confirmText:n="Xác nhận",cancelText:i="Hủy",variant:c="danger",loading:u=!1})=>{const x=()=>{e(),o()},h={danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 text-white focus:ring-yellow-500",info:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500"},p={danger:"text-red-600",warning:"text-yellow-600",info:"text-blue-600"},y={danger:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),warning:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),info:r.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})};return r.jsxs(xe,{isOpen:a,onClose:o,title:s,children:[r.jsx("div",{className:"mb-6",children:r.jsxs("div",{className:"flex items-start space-x-3",children:[r.jsx("div",{className:`flex-shrink-0 ${p[c]}`,children:y[c]}),r.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm leading-relaxed",children:t})]})}),r.jsxs("div",{className:"flex justify-end space-x-3",children:[r.jsx("button",{onClick:o,className:"btn-secondary",disabled:u,children:i}),r.jsx("button",{onClick:x,disabled:u,className:`px-4 py-2 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ${h[c]}`,children:u?r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),r.jsx("span",{children:"Đang xử lý..."})]}):n})]})]})},nr=()=>{const[a,o]=k.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});return{confirm:(t,n,i,c="danger",u)=>{o({isOpen:!0,title:t,message:n,onConfirm:i,variant:c,confirmText:u})},ConfirmComponent:()=>r.jsx(ar,{isOpen:a.isOpen,onClose:()=>o(t=>({...t,isOpen:!1})),onConfirm:a.onConfirm,title:a.title,message:a.message,variant:a.variant,confirmText:a.confirmText})}},ye=k.createContext(null),yr=({children:a})=>{const[o,e]=k.useState([]),s=k.useCallback((n,i,c=5e3)=>{const u=Date.now().toString(),x={id:u,message:n,type:i,duration:c};e(h=>[...h,x]),setTimeout(()=>{e(h=>h.filter(p=>p.id!==u))},c)},[]),t=n=>{e(i=>i.filter(c=>c.id!==n))};return r.jsxs(ye.Provider,{value:{showToast:s},children:[a,r.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:o.map(n=>r.jsx(or,{toast:n,onClose:()=>t(n.id)},n.id))})]})},or=({toast:a,onClose:o})=>{const e={success:qe,error:ie,warning:Ve},s={success:"bg-green-50 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-200 dark:border-green-800",error:"bg-red-50 text-red-800 border-red-200 dark:bg-red-900/20 dark:text-red-200 dark:border-red-800",warning:"bg-yellow-50 text-yellow-800 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-200 dark:border-yellow-800"},t=e[a.type];return r.jsx("div",{className:`p-4 rounded-lg border shadow-lg max-w-sm transform transition-all duration-300 ease-in-out ${s[a.type]}`,children:r.jsxs("div",{className:"flex items-center",children:[r.jsx(t,{className:"w-5 h-5 mr-3 flex-shrink-0"}),r.jsx("p",{className:"text-sm font-medium flex-1",children:a.message}),r.jsx("button",{onClick:o,className:"ml-3 text-current hover:opacity-70 transition-opacity","aria-label":"Đóng thông báo",children:r.jsx(ie,{className:"w-4 h-4"})})]})})},ir=()=>{const a=k.useContext(ye);if(!a)throw new Error("useToast must be used within ToastProvider");return a};function lr(a,o){const e=new Date;e.setHours(0,0,0,0);const s=new Date(o);if(s.setHours(0,0,0,0),a.isCompleted)return{task:a,displayDate:s,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};if(!a.startDate){if(!a.dueDate)return{task:a,displayDate:s,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};const y=new Date(a.dueDate);y.setHours(0,0,0,0);const b=y<e,A=y.getTime()===s.getTime();return{task:a,displayDate:s,isOverdue:b,isUrgent:b,urgencyLevel:b?"critical":"normal",shouldDisplay:A}}const t=new Date(a.startDate);t.setHours(0,0,0,0);const n=a.dueDate?new Date(a.dueDate):null;if(n&&n.setHours(0,0,0,0),e<t){const y=s.getTime()===t.getTime();return{task:a,displayDate:t,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:y}}if(n&&e>n){const y=s.getTime()===n.getTime();return{task:a,displayDate:n,isOverdue:!0,isUrgent:!0,urgencyLevel:"critical",shouldDisplay:y}}const i=s.getTime()===e.getTime();if(!n)return{task:a,displayDate:e,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:i};const c=Math.max(1,Math.ceil((n.getTime()-t.getTime())/(1e3*60*60*24))),u=Math.ceil((n.getTime()-e.getTime())/(1e3*60*60*24)),x=(c-u)/c;let h="normal",p=!1;return u<=1?(h="critical",p=!0):u<=3||x>=.8?(h="urgent",p=!0):x>=.6&&(h="urgent",p=!1),{task:a,displayDate:e,isOverdue:!1,isUrgent:p,urgencyLevel:h,shouldDisplay:i}}function be(a,o){return a.map(e=>lr(e,o)).filter(e=>e.shouldDisplay)}function cr(a,o){return o==="critical"?f.URGENT:o==="urgent"&&a.priority!==f.URGENT?f.HIGH:a.priority}const dr=({isOpen:a,onClose:o,selectedDate:e,tasks:s})=>{const{getGroupById:t}=fe(),{deleteTask:n}=pe(),{user:i}=J(),{confirm:c,ConfirmComponent:u}=nr(),{showToast:x}=ir(),[h,p]=k.useState(null),[y,b]=k.useState(!1);if(!e)return null;const C=be(s,e).sort((d,N)=>{if(d.urgencyLevel!==N.urgencyLevel){const w={critical:3,urgent:2,normal:1};return w[N.urgencyLevel]-w[d.urgencyLevel]}const j={[f.URGENT]:4,[f.HIGH]:3,[f.MEDIUM]:2,[f.LOW]:1};return j[N.task.priority]-j[d.task.priority]}),V=d=>d.toLocaleDateString("vi-VN",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),Y=d=>{switch(d){case f.URGENT:return"bg-red-500";case f.HIGH:return"bg-orange-500";case f.MEDIUM:return"bg-yellow-500";case f.LOW:return"bg-green-500";default:return"bg-gray-500"}},_=d=>{switch(d){case f.URGENT:return"Khẩn cấp";case f.HIGH:return"Cao";case f.MEDIUM:return"Trung bình";case f.LOW:return"Thấp";default:return"Không xác định"}},O=d=>{switch(d){case"critical":return"Cực kỳ khẩn cấp";case"urgent":return"Khẩn cấp";default:return""}},Z=d=>{p(d)},U=d=>{i&&c("Xóa công việc",`Bạn có chắc chắn muốn xóa công việc "${d.title}"?`,async()=>{b(!0);try{await n(i.uid,d.id),x("Đã xóa công việc thành công","success")}catch{x("Có lỗi xảy ra khi xóa công việc","error")}finally{b(!1)}},"danger","Xóa công việc")};return r.jsxs(r.Fragment,{children:[r.jsxs(xe,{isOpen:a&&!h,onClose:o,title:`Công việc ngày ${V(e)}`,className:"max-w-2xl",children:[r.jsx("div",{className:"max-h-96 overflow-y-auto",children:C.length===0?r.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:r.jsx("p",{children:"Không có công việc nào trong ngày này"})}):r.jsx("div",{className:"space-y-3",children:C.map(({task:d,isOverdue:N,urgencyLevel:j})=>{const w=d.groupId?t(d.groupId):null;return r.jsx("div",{className:`p-4 rounded-lg border ${N?"border-red-300 bg-red-50 dark:border-red-600 dark:bg-red-900/20":j==="critical"?"border-red-200 bg-red-25 dark:border-red-700 dark:bg-red-900/10":j==="urgent"?"border-orange-200 bg-orange-25 dark:border-orange-700 dark:bg-orange-900/10":"border-gray-200 bg-gray-50 dark:border-gray-600 dark:bg-gray-700"}`,children:r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[r.jsx("div",{className:`w-3 h-3 rounded-full ${Y(d.priority)}`}),r.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:d.title}),N&&r.jsx("span",{className:"text-red-600 font-bold text-sm",title:"Quá hạn",children:"⚠ Quá hạn"}),!N&&j==="critical"&&r.jsxs("span",{className:"text-red-500 font-bold text-sm",title:"Cực kỳ khẩn cấp",children:["🔥 ",O(j)]}),!N&&j==="urgent"&&r.jsxs("span",{className:"text-orange-500 font-bold text-sm",title:"Khẩn cấp",children:["⚡ ",O(j)]})]}),d.description&&r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:d.description}),r.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-500 dark:text-gray-400",children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("span",{children:"Độ ưu tiên:"}),r.jsx("span",{className:"font-medium",children:_(d.priority)})]}),w&&r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("span",{children:"Nhóm:"}),r.jsxs("span",{className:"font-medium",children:[w.icon," ",w.name]})]}),d.startDate&&r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("span",{children:"Bắt đầu:"}),r.jsx("span",{className:"font-medium",children:new Date(d.startDate).toLocaleDateString("vi-VN")})]}),d.dueDate&&r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("span",{children:"Hạn cuối:"}),r.jsx("span",{className:"font-medium",children:new Date(d.dueDate).toLocaleDateString("vi-VN")})]})]})]}),r.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[r.jsx("button",{onClick:()=>Z(d),className:"text-gray-400 hover:text-blue-600 transition-colors p-1 rounded",title:"Chỉnh sửa công việc",disabled:y,children:r.jsx(Xe,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>U(d),className:"text-gray-400 hover:text-red-600 transition-colors p-1 rounded",title:"Xóa công việc",disabled:y,children:r.jsx(Qe,{className:"w-4 h-4"})})]})]})},d.id)})})}),C.length>0&&r.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:r.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300",children:[r.jsxs("span",{children:["Tổng cộng: ",C.length," công việc"]}),r.jsxs("div",{className:"flex space-x-4",children:[C.filter(d=>d.urgencyLevel==="critical"||d.isOverdue).length>0&&r.jsxs("span",{className:"text-red-600",children:["Khẩn cấp: ",C.filter(d=>d.urgencyLevel==="critical"||d.isOverdue).length]}),C.filter(d=>d.urgencyLevel==="urgent"&&!d.isOverdue).length>0&&r.jsxs("span",{className:"text-orange-600",children:["Cần chú ý: ",C.filter(d=>d.urgencyLevel==="urgent"&&!d.isOverdue).length]})]})]})}),r.jsx(u,{})]}),h&&r.jsx(me,{task:h,onClose:()=>p(null),onSuccess:()=>{p(null),x("Cập nhật công việc thành công","success")}})]})},br=({tasks:a})=>{const[o,e]=k.useState(new Date),[s,t]=k.useState(null),[n,i]=k.useState(null),[c,u]=k.useState(null),[x,h]=k.useState(null),[p,y]=k.useState(null),[b,A]=k.useState(null),[C,V]=k.useState(!1),[Y,_]=k.useState(null),{user:O}=J(),{getGroupById:Z}=fe(),{filters:U,toggleTaskCompletion:d,updateTask:N}=pe(),j=U.groupId?a.filter(l=>l.groupId===U.groupId):a,w=o.getFullYear(),S=o.getMonth(),ve=new Date,ke=new Date(w,S,1),we=new Date(w,S+1,0).getDate(),De=ke.getDay(),Te=new Date(w,S-1,0),je=De,I=[];for(let l=je;l>0;l--){const m=Te.getDate()-l+1,T=new Date(w,S-1,m);I.push({date:T,day:m,isCurrentMonth:!1,isToday:!1})}for(let l=1;l<=we;l++){const m=new Date(w,S,l),T=m.toDateString()===ve.toDateString();I.push({date:m,day:l,isCurrentMonth:!0,isToday:T})}const Ne=42-I.length;for(let l=1;l<=Ne;l++){const m=new Date(w,S+1,l);I.push({date:m,day:l,isCurrentMonth:!1,isToday:!1})}const Ce=l=>be(j,l),Se=()=>{e(new Date(w,S-1,1))},Ee=()=>{e(new Date(w,S+1,1))},Ge=()=>{e(new Date)},te=l=>{_(l),V(!0)},Le=(l,m)=>{l.preventDefault(),l.stopPropagation(),!m.isCompleted&&i({x:l.clientX,y:l.clientY,task:m})},se=async l=>{if(O)try{await d(O.uid,l.id,!0),i(null)}catch(m){console.error("Failed to mark task as done:",m)}},ae=()=>{i(null),y(null)},Me=(l,m)=>{if(m.isCompleted){l.preventDefault();return}u(m),l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/plain",m.id)},Oe=(l,m)=>{l.preventDefault(),l.dataTransfer.dropEffect="move",h(m)},Re=()=>{h(null)},Ae=async(l,m)=>{if(l.preventDefault(),h(null),!c||!O)return;const T=new Date(m);T.setHours(23,59,59,999);try{await N(O.uid,c.id,{dueDate:T}),u(null)}catch(P){console.error("Failed to update task due date:",P),u(null)}},Ue=()=>{u(null),h(null)},$e=(l,m)=>{if(m.isCompleted)return;const T=l.touches[0],P=setTimeout(()=>{y({task:m,x:T.clientX,y:T.clientY})},500);A(P)},He=()=>{b&&(clearTimeout(b),A(null))},Ie=()=>{b&&(clearTimeout(b),A(null))};k.useEffect(()=>{if(n||p)return document.addEventListener("click",ae),()=>document.removeEventListener("click",ae)},[n,p]),k.useEffect(()=>()=>{b&&clearTimeout(b)},[b]);const Pe=l=>{switch(l){case f.URGENT:return"bg-red-500";case f.HIGH:return"bg-orange-500";case f.MEDIUM:return"bg-yellow-500";case f.LOW:return"bg-green-500";default:return"bg-gray-500"}},Fe=["January","February","March","April","May","June","July","August","September","October","November","December"],Be=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ne=(()=>{if(U.groupId){const l=Z(U.groupId);return l?`${l.icon} ${l.name}`:"Unknown Group"}return null})();return r.jsxs("div",{className:"w-full",children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-4",children:[r.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[Fe[S]," ",w]}),ne&&r.jsxs("span",{className:"text-sm text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 px-2 py-1 rounded-full",children:["Filtered by: ",ne]}),r.jsx("button",{onClick:Ge,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Today"})]}),r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("button",{onClick:Se,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:r.jsx(Je,{className:"w-5 h-5"})}),r.jsx("button",{onClick:Ee,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:r.jsx(Ye,{className:"w-5 h-5"})})]})]}),r.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:Be.map(l=>r.jsx("div",{className:"p-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400",children:l},l))}),r.jsx("div",{className:"grid grid-cols-7 gap-1",children:I.map((l,m)=>{const T=Ce(l.date),P=x?.toDateString()===l.date.toDateString();return r.jsxs("div",{className:`min-h-[96px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg transition-colors cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${l.isCurrentMonth?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900"} ${l.isToday?"ring-2 ring-primary-500":""} ${P?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700 border-2":""}`,onDragOver:E=>Oe(E,l.date),onDragLeave:Re,onDrop:E=>Ae(E,l.date),onDoubleClick:()=>te(l.date),title:"Double-click để xem tất cả công việc trong ngày",children:[r.jsx("div",{className:`text-sm font-medium mb-1 ${l.isCurrentMonth?l.isToday?"text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}`,children:l.day}),r.jsxs("div",{className:"space-y-1",children:[T.slice(0,4).map(E=>{const{task:D,isOverdue:F,urgencyLevel:R}=E,ze=cr(D,R),We=()=>F?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 border border-red-300 dark:border-red-700":R==="critical"?"bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300 border border-red-200 dark:border-red-800":R==="urgent"?"bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 border border-orange-200 dark:border-orange-800":"bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200";return r.jsx("div",{draggable:!D.isCompleted,className:`text-xs p-1 rounded truncate transition-all duration-200 ${We()} cursor-move hover:opacity-80 ${c?.id===D.id?"opacity-50 scale-95":""}`,title:`📋 ${D.title}
📊 Status: ${D.status.replace("-"," ")}
${D.dueDate?`📅 Due: ${D.dueDate.toLocaleDateString("vi-VN")}`:"📅 Due: Not set"}
${D.startDate?`🚀 Start: ${D.startDate.toLocaleDateString("vi-VN")}`:"🚀 Start: Not set"}
${F?"⚠️ OVERDUE":R==="critical"?"🔥 CRITICAL":R==="urgent"?"⚡ URGENT":""}`,onDragStart:v=>{v.stopPropagation(),Me(v,D)},onDragEnd:v=>{v.stopPropagation(),Ue()},onDoubleClick:v=>{v.stopPropagation(),t(D)},onContextMenu:v=>{v.stopPropagation(),Le(v,D)},onTouchStart:v=>{v.stopPropagation(),$e(v,D)},onTouchEnd:v=>{v.stopPropagation(),He()},onTouchMove:v=>{v.stopPropagation(),Ie()},children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center space-x-1 flex-1 min-w-0",children:[r.jsx("div",{className:`w-2 h-2 rounded-full ${Pe(ze)}`}),r.jsx("span",{className:"truncate",children:D.title}),F&&r.jsx("span",{className:"text-red-600 font-bold",title:"Overdue",children:"⚠"}),!F&&R==="critical"&&r.jsx("span",{className:"text-red-500 font-bold",title:"Critical urgency",children:"🔥"}),!F&&R==="urgent"&&r.jsx("span",{className:"text-orange-500 font-bold",title:"Urgent",children:"⚡"})]}),r.jsx("button",{className:"ml-1 text-gray-400 hover:text-gray-600 lg:hidden flex-shrink-0",onClick:v=>{v.stopPropagation();const oe=v.currentTarget.getBoundingClientRect();y({task:D,x:oe.right,y:oe.bottom})},onDoubleClick:v=>v.stopPropagation(),"aria-label":"Tùy chọn task",children:"⋮"}),r.jsx("span",{className:"text-gray-400 text-xs hidden lg:block",children:"⋮⋮"})]})},D.id)}),T.length>4&&r.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center cursor-pointer hover:text-gray-700 dark:hover:text-gray-300",onClick:E=>{E.stopPropagation(),te(l.date)},onDoubleClick:E=>E.stopPropagation(),title:"Click để xem tất cả công việc",children:["+",T.length-4," more"]})]})]},m)})}),r.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),r.jsx("span",{children:"Urgent"})]}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),r.jsx("span",{children:"High"})]}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),r.jsx("span",{children:"Medium"})]}),r.jsxs("div",{className:"flex items-center space-x-1",children:[r.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),r.jsx("span",{children:"Low"})]})]}),n&&r.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:n.x,top:n.y},onClick:l=>l.stopPropagation(),children:[r.jsxs("button",{onClick:()=>se(n.task),className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[r.jsx(le,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{children:"Hoàn thành"})]}),r.jsxs("button",{onClick:()=>{t(n.task),i(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),r.jsx("span",{children:"Chỉnh sửa"})]})]}),p&&r.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:p.x,top:p.y},onClick:l=>l.stopPropagation(),children:[r.jsxs("button",{onClick:()=>{se(p.task),y(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[r.jsx(le,{className:"w-4 h-4 text-green-600"}),r.jsx("span",{children:"Hoàn thành"})]}),r.jsxs("button",{onClick:()=>{t(p.task),y(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),r.jsx("span",{children:"Chỉnh sửa"})]})]}),s&&r.jsx(me,{task:s,onClose:()=>t(null),onSuccess:()=>t(null)}),r.jsx(dr,{isOpen:C,onClose:()=>V(!1),selectedDate:Y,tasks:j})]})};export{br as D,xe as M,f as P,Q as T,pe as a,nr as b,ir as c,yr as d,fe as u};
