import{r as k,j as t,F as Xe,a as Qe,b as de,c as Je,d as Ye,e as Ze,f as _e,g as er,h as ue}from"./vendor-C0uaCzFa.js";import{c as me}from"./state-vendor-C6akDs4E.js";import{d as J,e as ge,f as q,h as rr,j as G,k as pe,l as fe,q as O,w as Y,m as tr,o as se,n as ae,T as I,p as sr}from"./firebase-vendor-CwXsO73q.js";import{d as $,a as g,g as L,b as z,c as X,u as _}from"./auth-DbZI5HnD.js";import{T as xe}from"./tasks-C0e7jIQ_.js";const ar=(a,n)=>{const e=a.data();return{id:a.id,userId:n,...e,createdAt:e.createdAt?.toDate?.()||new Date}};class or{getGroupsCollection(n){return J($,"users",n,"groups")}async ensureDefaultGroup(n){try{const e=J($,"users",n,"groups"),s=await ge(e);for(const o of s.docs){const i=o.data();if(i.name==="Default"||i.name==="Nh√≥m m·∫∑c ƒë·ªãnh")return g("GroupService: Default group already exists",o.id),o.id}const r=q($,"users",n,"groups","default");return await rr(r,{name:"Default",color:"#6B7280",icon:"üìã",createdAt:G(),updatedAt:G()},{merge:!0}),g("GroupService: Created new default group"),"default"}catch(e){throw e}}async createGroup(n,e){try{g("GroupService: Creating group",{userId:n,groupData:e});const s={...e,createdAt:G(),updatedAt:G()};g("GroupService: Firestore data",s);const r=await pe(this.getGroupsCollection(n),s);return g("GroupService: Group created with ID",r.id),{id:r.id,error:null}}catch(s){return{id:null,error:L(s)}}}async updateGroup(n,e,s){try{const r=q(this.getGroupsCollection(n),e),o={...s,updatedAt:G()};return await fe(r,o),{error:null}}catch(r){return{error:L(r)}}}async deleteGroup(n,e){if(e==="default")return{error:"Kh√¥ng th·ªÉ x√≥a nh√≥m m·∫∑c ƒë·ªãnh"};try{const s=await this.ensureDefaultGroup(n),r=O(J($,"users",n,"tasks"),Y("groupId","==",e)),o=await ge(r),i=tr($);o.docs.forEach(u=>{i.update(u.ref,{groupId:s,updatedAt:G()})});const c=q(this.getGroupsCollection(n),e);return i.delete(c),await i.commit(),g("GroupService: Group deleted and tasks moved to default",{groupId:e,tasksCount:o.size}),{error:null}}catch(s){return{error:L(s)}}}subscribeToGroups(n,e){const s=O(this.getGroupsCollection(n),se("createdAt","asc"));return ae(s,r=>{g("GroupService: Received snapshot",{size:r.size,empty:r.empty,changes:r.docChanges().length});const o=r.docs.map(i=>{const c=ar(i,n);return g("GroupService: Converted group",{id:c.id,name:c.name}),c});g("GroupService: Calling callback with groups",o.length),e(o)},r=>{e([])})}}const K=new or;class H{static instance;authStateHistory=[];static getInstance(){return H.instance||(H.instance=new H),H.instance}async logAuthState(n){const e=z.currentUser;let s=null,r=!1;try{e&&(s=await e.getIdToken(),r=!0)}catch{}const o={timestamp:Date.now(),user:e?{uid:e.uid,email:e.email,emailVerified:e.emailVerified}:null,token:s?s.substring(0,20)+"...":null,ready:r};return this.authStateHistory.push(o),g(`üîç Auth State [${n}]:`,{timestamp:new Date().toISOString()}),o}logFirestoreOperation(n,e,s){return{operation:n,userId:e,timestamp:Date.now(),error:s?{code:s.code,message:s.message}:null}}getDebugReport(){return{authHistory:this.authStateHistory,currentAuth:{user:z.currentUser?{uid:z.currentUser.uid,email:z.currentUser.email}:null,timestamp:Date.now()}}}async waitForAuthReady(n=5e3){const e=Date.now();for(;Date.now()-e<n;){const s=z.currentUser;if(s)try{return await s.getIdToken(),g("üéâ Auth is ready!",{uid:s.uid,waitTime:Date.now()-e}),!0}catch{}await new Promise(r=>setTimeout(r,100))}return!1}}const M=H.getInstance(),ye=me((a,n)=>({groups:[],loading:!1,error:null,unsubscribe:null,setGroups:e=>a({groups:e}),setLoading:e=>a({loading:e}),setError:e=>a({error:e}),setUnsubscribe:e=>a({unsubscribe:e}),fetchGroups:()=>{const{unsubscribe:e}=n();e&&e(),a({loading:!0,error:null});const r=_.getState().user;if(!r){a({loading:!1,error:"User not authenticated"});return}const o=async(i=3)=>{try{if(await M.logAuthState(`GroupStore-fetchGroups-attempt-${4-i}`),!await M.waitForAuthReady(2e3))throw new Error("Auth timeout - user not ready");M.logFirestoreOperation("ensureDefaultGroup-start",r.uid),await K.ensureDefaultGroup(r.uid),M.logFirestoreOperation("ensureDefaultGroup-success",r.uid),M.logFirestoreOperation("subscribeToGroups-start",r.uid);const u=K.subscribeToGroups(r.uid,p=>{M.logFirestoreOperation("subscribeToGroups-callback",r.uid),a({groups:p,loading:!1,error:null})});a({unsubscribe:u}),M.logFirestoreOperation("subscribeToGroups-success",r.uid)}catch(c){if(M.logFirestoreOperation("fetchGroups-error",r.uid,c),c.code==="permission-denied"&&i>0){setTimeout(()=>o(i-1),1e3);return}a({loading:!1,error:"Failed to load groups. Please try refreshing the page."})}};o()},createGroup:async(e,s)=>{a({loading:!0,error:null});try{const r=await K.createGroup(e,s);if(g("GroupStore: Create group result",r),r.error)throw X("GroupStore: Create group failed",r.error),a({error:r.error,loading:!1}),new Error(r.error);g("GroupStore: Group created successfully",r.id),a({loading:!1})}catch(r){throw a({error:r.message,loading:!1}),r}},updateGroup:async(e,s,r)=>{try{const o=await K.updateGroup(e,s,r);o.error&&a({error:o.error})}catch(o){const i=L(o);a({error:i})}},deleteGroup:async(e,s)=>{try{const r=await K.deleteGroup(e,s);if(r.error)throw a({error:r.error}),new Error(r.error)}catch(r){const o=L(r);throw a({error:o}),r}},getGroupById:e=>{const{groups:s}=n();return s.find(r=>r.id===e)},getDefaultGroup:()=>{const{groups:e}=n();return e.find(s=>s.name==="Default"||s.name==="Nh√≥m m·∫∑c ƒë·ªãnh")||{id:"default",name:"Default",color:"#6B7280",icon:"üìã",userId:"",createdAt:new Date}}}));var f=(a=>(a.LOW="low",a.MEDIUM="medium",a.HIGH="high",a.URGENT="urgent",a))(f||{}),Z=(a=>(a.TODO="todo",a.IN_PROGRESS="in-progress",a.COMPLETED="completed",a.CANCELLED="cancelled",a))(Z||{});const he=(a,n)=>{const e=a.data();return{id:a.id,userId:n,...e,startDate:e.startDate?.toDate?.()||null,dueDate:e.dueDate?.toDate?.()||null,createdAt:e.createdAt?.toDate?.()||new Date,updatedAt:e.updatedAt?.toDate?.()||new Date,completedAt:e.completedAt?.toDate?.()||null}};class nr{getTasksCollection(n){return J($,"users",n,"tasks")}async createTask(n,e){try{g("TaskService: Creating task",{userId:n,taskData:e});const s={...e,startDate:e.startDate?I.fromDate(e.startDate):null,dueDate:e.dueDate?I.fromDate(e.dueDate):null,completedAt:e.completedAt?I.fromDate(e.completedAt):null,createdAt:G(),updatedAt:G()};g("TaskService: Firestore data",s);const r=await pe(this.getTasksCollection(n),s);return g("TaskService: Task created with ID",r.id),{id:r.id,error:null}}catch(s){return{id:null,error:L(s)}}}async updateTask(n,e,s){try{g("TaskService: Updating task",{userId:n,taskId:e,updates:s});const r=q(this.getTasksCollection(n),e),o={};Object.keys(s).forEach(c=>{const u=s[c];u!==void 0&&(o[c]=u)});const i={...o,updatedAt:G()};return s.startDate!==void 0&&(i.startDate=s.startDate?I.fromDate(s.startDate):null),s.dueDate!==void 0&&(i.dueDate=s.dueDate?I.fromDate(s.dueDate):null),s.completedAt!==void 0&&(i.completedAt=s.completedAt?I.fromDate(s.completedAt):null),g("TaskService: Clean update data",i),await fe(r,i),g("TaskService: Task updated successfully"),{error:null}}catch(r){return{error:L(r)}}}async deleteTask(n,e){try{const s=q(this.getTasksCollection(n),e);return await sr(s),{error:null}}catch(s){return{error:L(s)}}}async toggleTaskCompletion(n,e,s){try{g("TaskService: Toggling task completion",{userId:n,taskId:e,isCompleted:s});const r={isCompleted:s,status:s?Z.COMPLETED:Z.TODO,completedAt:s?new Date:null};g("TaskService: Update data for toggle",r);const o=await this.updateTask(n,e,r);return o.error?X("TaskService: Toggle completion failed",o.error):g("TaskService: Toggle completion successful"),o}catch(r){return{error:L(r)}}}subscribeToTasks(n,e){const s=O(this.getTasksCollection(n),se("createdAt","desc"));return ae(s,r=>{g("TaskService: Received snapshot",{size:r.size,empty:r.empty,changes:r.docChanges().length});const o=r.docs.map(i=>{const c=he(i,n);return g("TaskService: Converted task",{id:c.id,title:c.title}),c});g("TaskService: Calling callback with tasks",o.length),e(o)},r=>{e([])})}subscribeToFilteredTasks(n,e,s){let r=O(this.getTasksCollection(n));return e.status&&e.status.length>0&&(r=O(r,Y("status","in",e.status))),e.priority&&e.priority.length>0&&(r=O(r,Y("priority","in",e.priority))),e.categoryId&&(r=O(r,Y("categoryId","==",e.categoryId))),r=O(r,se("createdAt","desc")),ae(r,o=>{const i=o.docs.map(c=>he(c,n));s(i)})}}const V=new nr,be=me((a,n)=>({tasks:[],loading:!1,error:null,filters:{},sort:{field:"createdAt",direction:"desc"},unsubscribe:null,setTasks:e=>a({tasks:e}),setLoading:e=>a({loading:e}),setError:e=>a({error:e}),setFilters:e=>a({filters:e}),setSort:e=>a({sort:e}),setUnsubscribe:e=>a({unsubscribe:e}),fetchTasks:()=>{const{unsubscribe:e}=n();e&&e(),a({loading:!0,error:null});const r=_.getState().user;if(!r){a({loading:!1,error:"User not authenticated"});return}const o=async(i=3)=>{try{await new Promise(u=>setTimeout(u,300));const c=V.subscribeToTasks(r.uid,u=>{a({tasks:u,loading:!1,error:null})});a({unsubscribe:c})}catch(c){if(c.code==="permission-denied"&&i>0){setTimeout(()=>o(i-1),500);return}a({loading:!1,error:"Failed to load tasks. Please try refreshing the page."})}};o()},createTask:async(e,s)=>{a({loading:!0,error:null});try{const r=await V.createTask(e,s);if(g("TaskStore: Create task result",r),r.error)throw X("TaskStore: Create task failed",r.error),a({error:r.error,loading:!1}),new Error(r.error);g("TaskStore: Task created successfully",r.id),a({loading:!1})}catch(r){throw a({error:r.message,loading:!1}),r}},updateTask:async(e,s,r)=>{try{g("TaskStore: Updating task",{userId:e,taskId:s,updates:r});const o=await V.updateTask(e,s,r);if(o.error)throw X("TaskStore: Update task failed",o.error),a({error:o.error}),new Error(o.error);g("TaskStore: Update task successful")}catch(o){throw a({error:o.message}),o}},deleteTask:async(e,s)=>{try{const r=await V.deleteTask(e,s);if(r.error)throw a({error:r.error}),new Error(r.error)}catch(r){throw a({error:r.message}),r}},toggleTaskCompletion:async(e,s,r)=>{try{g("TaskStore: Toggling task completion",{taskId:s,isCompleted:r});const o=await V.toggleTaskCompletion(e,s,r);if(o.error)throw X("TaskStore: Toggle completion failed",o.error),a({error:o.error}),new Error(o.error);g("TaskStore: Toggle completion successful")}catch(o){throw a({error:o.message}),o}},getFilteredTasks:()=>{const{tasks:e,filters:s,sort:r}=n();let o=[...e];if(s.status&&s.status.length>0&&(o=o.filter(i=>s.status.includes(i.status))),s.priority&&s.priority.length>0&&(o=o.filter(i=>s.priority.includes(i.priority))),s.groupId&&(o=o.filter(i=>i.groupId===s.groupId)),s.searchQuery){const i=s.searchQuery.toLowerCase();o=o.filter(c=>c.title.toLowerCase().includes(i)||c.description?.toLowerCase().includes(i))}return s.dateRange&&(o=o.filter(i=>i.dueDate?i.dueDate>=s.dateRange.start&&i.dueDate<=s.dateRange.end:!1)),o.sort((i,c)=>{let u,p;switch(r.field){case"dueDate":u=i.dueDate?.getTime()||0,p=c.dueDate?.getTime()||0;break;case"createdAt":u=i.createdAt.getTime(),p=c.createdAt.getTime();break;case"priority":const h={[f.URGENT]:4,[f.HIGH]:3,[f.MEDIUM]:2,[f.LOW]:1};u=h[i.priority],p=h[c.priority];break;case"title":u=i.title.toLowerCase(),p=c.title.toLowerCase();break;default:return 0}return r.direction==="asc"?u>p?1:-1:u<p?1:-1}),o},getTasksByStatus:e=>{const{tasks:s}=n();return s.filter(r=>r.status===e)},getOverdueTasks:()=>{const{tasks:e}=n(),s=new Date;return e.filter(r=>r.dueDate&&r.dueDate<s&&r.status!==Z.COMPLETED)}})),ve=({isOpen:a,onClose:n,title:e,children:s,className:r=""})=>{const o=k.useRef(null),i=k.useRef(null);return k.useEffect(()=>{if(!a)return;const c=o.current;if(!c)return;i.current?.focus();const u=c.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),p=u[0],h=u[u.length-1],x=b=>{b.key==="Tab"&&(b.shiftKey?document.activeElement===p&&(b.preventDefault(),h?.focus()):document.activeElement===h&&(b.preventDefault(),p?.focus()))},y=b=>{b.key==="Escape"&&n()};return document.addEventListener("keydown",x),document.addEventListener("keydown",y),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",x),document.removeEventListener("keydown",y),document.body.style.overflow="unset"}},[a,n]),a?t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",onClick:n,children:t.jsxs("div",{ref:o,className:`relative top-20 mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white dark:bg-gray-800 ${r}`,role:"dialog","aria-modal":"true","aria-labelledby":"modal-title",onClick:c=>c.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{ref:i,id:"modal-title",className:"text-lg font-medium text-gray-900 dark:text-white",tabIndex:-1,children:e}),t.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"ƒê√≥ng modal",children:t.jsx(Xe,{className:"w-6 h-6"})})]}),s]})}):null},ir=({isOpen:a,onClose:n,onConfirm:e,title:s,message:r,confirmText:o="X√°c nh·∫≠n",cancelText:i="H·ªßy",variant:c="danger",loading:u=!1})=>{const p=()=>{e(),n()},h={danger:"bg-red-600 hover:bg-red-700 text-white focus:ring-red-500",warning:"bg-yellow-600 hover:bg-yellow-700 text-white focus:ring-yellow-500",info:"bg-blue-600 hover:bg-blue-700 text-white focus:ring-blue-500"},x={danger:"text-red-600",warning:"text-yellow-600",info:"text-blue-600"},y={danger:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),warning:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),info:t.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})};return t.jsxs(ve,{isOpen:a,onClose:n,title:s,children:[t.jsx("div",{className:"mb-6",children:t.jsxs("div",{className:"flex items-start space-x-3",children:[t.jsx("div",{className:`flex-shrink-0 ${x[c]}`,children:y[c]}),t.jsx("p",{className:"text-gray-600 dark:text-gray-300 text-sm leading-relaxed",children:r})]})}),t.jsxs("div",{className:"flex justify-end space-x-3",children:[t.jsx("button",{onClick:n,className:"btn-secondary",disabled:u,children:i}),t.jsx("button",{onClick:p,disabled:u,className:`px-4 py-2 rounded-lg font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed ${h[c]}`,children:u?t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),t.jsx("span",{children:"ƒêang x·ª≠ l√Ω..."})]}):o})]})]})},lr=()=>{const[a,n]=k.useState({isOpen:!1,title:"",message:"",onConfirm:()=>{}});return{confirm:(r,o,i,c="danger",u)=>{n({isOpen:!0,title:r,message:o,onConfirm:i,variant:c,confirmText:u})},ConfirmComponent:()=>t.jsx(ir,{isOpen:a.isOpen,onClose:()=>n(r=>({...r,isOpen:!1})),onConfirm:a.onConfirm,title:a.title,message:a.message,variant:a.variant,confirmText:a.confirmText})}},ke=k.createContext(null),kr=({children:a})=>{const[n,e]=k.useState([]),s=k.useCallback((o,i,c=5e3)=>{const u=Date.now().toString(),p={id:u,message:o,type:i,duration:c};e(h=>[...h,p]),setTimeout(()=>{e(h=>h.filter(x=>x.id!==u))},c)},[]),r=o=>{e(i=>i.filter(c=>c.id!==o))};return t.jsxs(ke.Provider,{value:{showToast:s},children:[a,t.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:n.map(o=>t.jsx(cr,{toast:o,onClose:()=>r(o.id)},o.id))})]})},cr=({toast:a,onClose:n})=>{const e={success:Je,error:de,warning:Qe},s={success:"bg-green-50 text-green-800 border-green-200 dark:bg-green-900/20 dark:text-green-200 dark:border-green-800",error:"bg-red-50 text-red-800 border-red-200 dark:bg-red-900/20 dark:text-red-200 dark:border-red-800",warning:"bg-yellow-50 text-yellow-800 border-yellow-200 dark:bg-yellow-900/20 dark:text-yellow-200 dark:border-yellow-800"},r=e[a.type];return t.jsx("div",{className:`p-4 rounded-lg border shadow-lg max-w-sm transform transition-all duration-300 ease-in-out ${s[a.type]}`,children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(r,{className:"w-5 h-5 mr-3 flex-shrink-0"}),t.jsx("p",{className:"text-sm font-medium flex-1",children:a.message}),t.jsx("button",{onClick:n,className:"ml-3 text-current hover:opacity-70 transition-opacity","aria-label":"ƒê√≥ng th√¥ng b√°o",children:t.jsx(de,{className:"w-4 h-4"})})]})})},dr=()=>{const a=k.useContext(ke);if(!a)throw new Error("useToast must be used within ToastProvider");return a};function ur(a,n){const e=new Date;e.setHours(0,0,0,0);const s=new Date(n);if(s.setHours(0,0,0,0),a.isCompleted)return{task:a,displayDate:s,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};if(!a.startDate){if(!a.dueDate)return{task:a,displayDate:s,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};const y=new Date(a.dueDate);y.setHours(0,0,0,0);const b=y<e,U=y.getTime()===s.getTime();return{task:a,displayDate:s,isOverdue:b,isUrgent:b,urgencyLevel:b?"critical":"normal",shouldDisplay:U}}const r=new Date(a.startDate);r.setHours(0,0,0,0);const o=a.dueDate?new Date(a.dueDate):null;if(o&&o.setHours(0,0,0,0),e<r){const y=s.getTime()===r.getTime();return{task:a,displayDate:r,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:y}}if(o&&e>o){const y=s.getTime()===o.getTime();return{task:a,displayDate:o,isOverdue:!0,isUrgent:!0,urgencyLevel:"critical",shouldDisplay:y}}const i=s.getTime()===e.getTime();if(!o)return{task:a,displayDate:e,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:i};const c=Math.max(1,Math.ceil((o.getTime()-r.getTime())/(1e3*60*60*24))),u=Math.ceil((o.getTime()-e.getTime())/(1e3*60*60*24)),p=(c-u)/c;let h="normal",x=!1;return u<=1?(h="critical",x=!0):u<=3||p>=.8?(h="urgent",x=!0):p>=.6&&(h="urgent",x=!1),{task:a,displayDate:e,isOverdue:!1,isUrgent:x,urgencyLevel:h,shouldDisplay:i}}function we(a,n){return a.map(e=>ur(e,n)).filter(e=>e.shouldDisplay)}function gr(a,n){return n==="critical"?f.URGENT:n==="urgent"&&a.priority!==f.URGENT?f.HIGH:a.priority}const hr=({isOpen:a,onClose:n,selectedDate:e,tasks:s})=>{const{getGroupById:r}=ye(),{deleteTask:o}=be(),{user:i}=_(),{confirm:c,ConfirmComponent:u}=lr(),{showToast:p}=dr(),[h,x]=k.useState(null),[y,b]=k.useState(!1);if(!e)return null;const C=we(s,e).sort((d,N)=>{if(d.urgencyLevel!==N.urgencyLevel){const w={critical:3,urgent:2,normal:1};return w[N.urgencyLevel]-w[d.urgencyLevel]}const j={[f.URGENT]:4,[f.HIGH]:3,[f.MEDIUM]:2,[f.LOW]:1};return j[N.task.priority]-j[d.task.priority]}),Q=d=>d.toLocaleDateString("vi-VN",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),ee=d=>{switch(d){case f.URGENT:return"bg-red-500";case f.HIGH:return"bg-orange-500";case f.MEDIUM:return"bg-yellow-500";case f.LOW:return"bg-green-500";default:return"bg-gray-500"}},re=d=>{switch(d){case f.URGENT:return"Kh·∫©n c·∫•p";case f.HIGH:return"Cao";case f.MEDIUM:return"Trung b√¨nh";case f.LOW:return"Th·∫•p";default:return"Kh√¥ng x√°c ƒë·ªãnh"}},R=d=>{switch(d){case"critical":return"C·ª±c k·ª≥ kh·∫©n c·∫•p";case"urgent":return"Kh·∫©n c·∫•p";default:return""}},te=d=>{x(d)},F=d=>{i&&c("X√≥a c√¥ng vi·ªác",`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√¥ng vi·ªác "${d.title}"?`,async()=>{b(!0);try{await o(i.uid,d.id),p("ƒê√£ x√≥a c√¥ng vi·ªác th√†nh c√¥ng","success")}catch{p("C√≥ l·ªói x·∫£y ra khi x√≥a c√¥ng vi·ªác","error")}finally{b(!1)}},"danger","X√≥a c√¥ng vi·ªác")};return t.jsxs(t.Fragment,{children:[t.jsxs(ve,{isOpen:a&&!h,onClose:n,title:`C√¥ng vi·ªác ng√†y ${Q(e)}`,className:"max-w-2xl",children:[t.jsx("div",{className:"max-h-96 overflow-y-auto",children:C.length===0?t.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:t.jsx("p",{children:"Kh√¥ng c√≥ c√¥ng vi·ªác n√†o trong ng√†y n√†y"})}):t.jsx("div",{className:"space-y-3",children:C.map(({task:d,isOverdue:N,urgencyLevel:j})=>{const w=d.groupId?r(d.groupId):null;return t.jsx("div",{className:`p-4 rounded-lg border ${N?"border-red-300 bg-red-50 dark:border-red-600 dark:bg-red-900/20":j==="critical"?"border-red-200 bg-red-25 dark:border-red-700 dark:bg-red-900/10":j==="urgent"?"border-orange-200 bg-orange-25 dark:border-orange-700 dark:bg-orange-900/10":"border-gray-200 bg-gray-50 dark:border-gray-600 dark:bg-gray-700"}`,children:t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("div",{className:`w-3 h-3 rounded-full ${ee(d.priority)}`}),t.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:d.title}),N&&t.jsx("span",{className:"text-red-600 font-bold text-sm",title:"Qu√° h·∫°n",children:"‚ö† Qu√° h·∫°n"}),!N&&j==="critical"&&t.jsxs("span",{className:"text-red-500 font-bold text-sm",title:"C·ª±c k·ª≥ kh·∫©n c·∫•p",children:["üî• ",R(j)]}),!N&&j==="urgent"&&t.jsxs("span",{className:"text-orange-500 font-bold text-sm",title:"Kh·∫©n c·∫•p",children:["‚ö° ",R(j)]})]}),d.description&&t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-2",children:d.description}),t.jsxs("div",{className:"flex flex-wrap items-center gap-4 text-xs text-gray-500 dark:text-gray-400",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{children:"ƒê·ªô ∆∞u ti√™n:"}),t.jsx("span",{className:"font-medium",children:re(d.priority)})]}),w&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{children:"Nh√≥m:"}),t.jsxs("span",{className:"font-medium",children:[w.icon," ",w.name]})]}),d.startDate&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{children:"B·∫Øt ƒë·∫ßu:"}),t.jsx("span",{className:"font-medium",children:new Date(d.startDate).toLocaleDateString("vi-VN")})]}),d.dueDate&&t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("span",{children:"H·∫°n cu·ªëi:"}),t.jsx("span",{className:"font-medium",children:new Date(d.dueDate).toLocaleDateString("vi-VN")})]})]})]}),t.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[t.jsx("button",{onClick:()=>te(d),className:"text-gray-400 hover:text-blue-600 transition-colors p-1 rounded",title:"Ch·ªânh s·ª≠a c√¥ng vi·ªác",disabled:y,children:t.jsx(Ye,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>F(d),className:"text-gray-400 hover:text-red-600 transition-colors p-1 rounded",title:"X√≥a c√¥ng vi·ªác",disabled:y,children:t.jsx(Ze,{className:"w-4 h-4"})})]})]})},d.id)})})}),C.length>0&&t.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-600",children:t.jsxs("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-300",children:[t.jsxs("span",{children:["T·ªïng c·ªông: ",C.length," c√¥ng vi·ªác"]}),t.jsxs("div",{className:"flex space-x-4",children:[C.filter(d=>d.urgencyLevel==="critical"||d.isOverdue).length>0&&t.jsxs("span",{className:"text-red-600",children:["Kh·∫©n c·∫•p: ",C.filter(d=>d.urgencyLevel==="critical"||d.isOverdue).length]}),C.filter(d=>d.urgencyLevel==="urgent"&&!d.isOverdue).length>0&&t.jsxs("span",{className:"text-orange-600",children:["C·∫ßn ch√∫ √Ω: ",C.filter(d=>d.urgencyLevel==="urgent"&&!d.isOverdue).length]})]})]})}),t.jsx(u,{})]}),h&&t.jsx(xe,{task:h,onClose:()=>x(null),onSuccess:()=>{x(null),p("C·∫≠p nh·∫≠t c√¥ng vi·ªác th√†nh c√¥ng","success")}})]})},wr=({tasks:a})=>{const[n,e]=k.useState(new Date),[s,r]=k.useState(null),[o,i]=k.useState(null),[c,u]=k.useState(null),[p,h]=k.useState(null),[x,y]=k.useState(null),[b,U]=k.useState(null),[C,Q]=k.useState(!1),[ee,re]=k.useState(null),{user:R}=_(),{getGroupById:te}=ye(),{filters:F,toggleTaskCompletion:d,updateTask:N}=be(),j=F.groupId?a.filter(l=>l.groupId===F.groupId):a,w=n.getFullYear(),S=n.getMonth(),De=new Date,Te=new Date(w,S,1),je=new Date(w,S+1,0).getDate(),Ne=Te.getDay(),Ce=new Date(w,S-1,0),Se=Ne,P=[];for(let l=Se;l>0;l--){const m=Ce.getDate()-l+1,T=new Date(w,S-1,m);P.push({date:T,day:m,isCurrentMonth:!1,isToday:!1})}for(let l=1;l<=je;l++){const m=new Date(w,S,l),T=m.toDateString()===De.toDateString();P.push({date:m,day:l,isCurrentMonth:!0,isToday:T})}const Ee=42-P.length;for(let l=1;l<=Ee;l++){const m=new Date(w,S+1,l);P.push({date:m,day:l,isCurrentMonth:!1,isToday:!1})}const Ge=l=>we(j,l),Le=()=>{e(new Date(w,S-1,1))},Me=()=>{e(new Date(w,S+1,1))},Oe=()=>{e(new Date)},oe=l=>{re(l),Q(!0)},Re=(l,m)=>{l.preventDefault(),l.stopPropagation(),!m.isCompleted&&i({x:l.clientX,y:l.clientY,task:m})},ne=async l=>{if(R)try{await d(R.uid,l.id,!0),i(null)}catch(m){console.error("Failed to mark task as done:",m)}},ie=()=>{i(null),y(null)},Ae=(l,m)=>{if(m.isCompleted){l.preventDefault();return}u(m),l.dataTransfer.effectAllowed="move",l.dataTransfer.setData("text/plain",m.id)},Ue=(l,m)=>{l.preventDefault(),l.dataTransfer.dropEffect="move",h(m)},Fe=()=>{h(null)},Ie=async(l,m)=>{if(l.preventDefault(),h(null),!c||!R)return;const T=new Date(m);T.setHours(23,59,59,999);try{await N(R.uid,c.id,{dueDate:T}),u(null)}catch(B){console.error("Failed to update task due date:",B),u(null)}},$e=()=>{u(null),h(null)},He=(l,m)=>{if(m.isCompleted)return;const T=l.touches[0],B=setTimeout(()=>{y({task:m,x:T.clientX,y:T.clientY})},500);U(B)},Pe=()=>{b&&(clearTimeout(b),U(null))},Be=()=>{b&&(clearTimeout(b),U(null))};k.useEffect(()=>{if(o||x)return document.addEventListener("click",ie),()=>document.removeEventListener("click",ie)},[o,x]),k.useEffect(()=>()=>{b&&clearTimeout(b)},[b]);const We=l=>{switch(l){case f.URGENT:return"bg-red-500";case f.HIGH:return"bg-orange-500";case f.MEDIUM:return"bg-yellow-500";case f.LOW:return"bg-green-500";default:return"bg-gray-500"}},ze=["January","February","March","April","May","June","July","August","September","October","November","December"],Ke=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],le=(()=>{if(F.groupId){const l=te(F.groupId);return l?`${l.icon} ${l.name}`:"Unknown Group"}return null})();return t.jsxs("div",{className:"w-full",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[ze[S]," ",w]}),le&&t.jsxs("span",{className:"text-sm text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 px-2 py-1 rounded-full",children:["Filtered by: ",le]}),t.jsx("button",{onClick:Oe,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Today"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:Le,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:t.jsx(_e,{className:"w-5 h-5"})}),t.jsx("button",{onClick:Me,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:t.jsx(er,{className:"w-5 h-5"})})]})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:Ke.map(l=>t.jsx("div",{className:"p-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400",children:l},l))}),t.jsx("div",{className:"grid grid-cols-7 gap-1",children:P.map((l,m)=>{const T=Ge(l.date),B=p?.toDateString()===l.date.toDateString();return t.jsxs("div",{className:`min-h-[96px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg transition-colors cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 ${l.isCurrentMonth?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900"} ${l.isToday?"ring-2 ring-primary-500":""} ${B?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700 border-2":""}`,onDragOver:E=>Ue(E,l.date),onDragLeave:Fe,onDrop:E=>Ie(E,l.date),onDoubleClick:()=>oe(l.date),title:"Double-click ƒë·ªÉ xem t·∫•t c·∫£ c√¥ng vi·ªác trong ng√†y",children:[t.jsx("div",{className:`text-sm font-medium mb-1 ${l.isCurrentMonth?l.isToday?"text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}`,children:l.day}),t.jsxs("div",{className:"space-y-1",children:[T.slice(0,4).map(E=>{const{task:D,isOverdue:W,urgencyLevel:A}=E,Ve=gr(D,A),qe=()=>W?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 border border-red-300 dark:border-red-700":A==="critical"?"bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300 border border-red-200 dark:border-red-800":A==="urgent"?"bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 border border-orange-200 dark:border-orange-800":"bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200";return t.jsx("div",{draggable:!D.isCompleted,className:`text-xs p-1 rounded truncate transition-all duration-200 ${qe()} cursor-move hover:opacity-80 ${c?.id===D.id?"opacity-50 scale-95":""}`,title:`üìã ${D.title}
üìä Status: ${D.status.replace("-"," ")}
${D.dueDate?`üìÖ Due: ${D.dueDate.toLocaleDateString("vi-VN")}`:"üìÖ Due: Not set"}
${D.startDate?`üöÄ Start: ${D.startDate.toLocaleDateString("vi-VN")}`:"üöÄ Start: Not set"}
${W?"‚ö†Ô∏è OVERDUE":A==="critical"?"üî• CRITICAL":A==="urgent"?"‚ö° URGENT":""}`,onDragStart:v=>{v.stopPropagation(),Ae(v,D)},onDragEnd:v=>{v.stopPropagation(),$e()},onDoubleClick:v=>{v.stopPropagation(),r(D)},onContextMenu:v=>{v.stopPropagation(),Re(v,D)},onTouchStart:v=>{v.stopPropagation(),He(v,D)},onTouchEnd:v=>{v.stopPropagation(),Pe()},onTouchMove:v=>{v.stopPropagation(),Be()},children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-1 flex-1 min-w-0",children:[t.jsx("div",{className:`w-2 h-2 rounded-full ${We(Ve)}`}),t.jsx("span",{className:"truncate",children:D.title}),W&&t.jsx("span",{className:"text-red-600 font-bold",title:"Overdue",children:"‚ö†"}),!W&&A==="critical"&&t.jsx("span",{className:"text-red-500 font-bold",title:"Critical urgency",children:"üî•"}),!W&&A==="urgent"&&t.jsx("span",{className:"text-orange-500 font-bold",title:"Urgent",children:"‚ö°"})]}),t.jsx("button",{className:"ml-1 text-gray-400 hover:text-gray-600 lg:hidden flex-shrink-0",onClick:v=>{v.stopPropagation();const ce=v.currentTarget.getBoundingClientRect();y({task:D,x:ce.right,y:ce.bottom})},onDoubleClick:v=>v.stopPropagation(),"aria-label":"T√πy ch·ªçn task",children:"‚ãÆ"}),t.jsx("span",{className:"text-gray-400 text-xs hidden lg:block",children:"‚ãÆ‚ãÆ"})]})},D.id)}),T.length>4&&t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center cursor-pointer hover:text-gray-700 dark:hover:text-gray-300",onClick:E=>{E.stopPropagation(),oe(l.date)},onDoubleClick:E=>E.stopPropagation(),title:"Click ƒë·ªÉ xem t·∫•t c·∫£ c√¥ng vi·ªác",children:["+",T.length-4," more"]})]})]},m)})}),t.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),t.jsx("span",{children:"Urgent"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),t.jsx("span",{children:"High"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),t.jsx("span",{children:"Medium"})]}),t.jsxs("div",{className:"flex items-center space-x-1",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),t.jsx("span",{children:"Low"})]})]}),o&&t.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:o.x,top:o.y},onClick:l=>l.stopPropagation(),children:[t.jsxs("button",{onClick:()=>ne(o.task),className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[t.jsx(ue,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{children:"Ho√†n th√†nh"})]}),t.jsxs("button",{onClick:()=>{r(o.task),i(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),t.jsx("span",{children:"Ch·ªânh s·ª≠a"})]})]}),x&&t.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:x.x,top:x.y},onClick:l=>l.stopPropagation(),children:[t.jsxs("button",{onClick:()=>{ne(x.task),y(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[t.jsx(ue,{className:"w-4 h-4 text-green-600"}),t.jsx("span",{children:"Ho√†n th√†nh"})]}),t.jsxs("button",{onClick:()=>{r(x.task),y(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),t.jsx("span",{children:"Ch·ªânh s·ª≠a"})]})]}),s&&t.jsx(xe,{task:s,onClose:()=>r(null),onSuccess:()=>r(null)}),t.jsx(hr,{isOpen:C,onClose:()=>Q(!1),selectedDate:ee,tasks:j})]})};export{wr as D,ve as M,f as P,Z as T,be as a,lr as b,dr as c,kr as d,M as f,ye as u};
