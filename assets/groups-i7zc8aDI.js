import{r as h,j as e,i as S,g as $,k as E,d as I,e as T}from"./react-vendor-pFVYdC-7.js";import{u as G,M as B,a as R,b as L,c as O}from"./calendar-K0YHDWnX.js";import{u as D,L as X}from"./auth-BoLvIiX1.js";const q=({group:s,onClose:c,onSuccess:j})=>{const{user:f}=D(),{createGroup:l,updateGroup:N}=G(),[u,x]=h.useState(!1),[k,i]=h.useState(""),[r,v]=h.useState({name:s?.name||"",color:s?.color||"#3B82F6",icon:s?.icon||"üìÅ"}),y=async a=>{if(a.preventDefault(),!f){i("User not authenticated");return}if(!r.name.trim()){i("Group name is required");return}const m=r.name.trim(),d=s&&(s.name==="Default"||s.name==="Nh√≥m m·∫∑c ƒë·ªãnh");if(!d&&(m==="Default"||m==="Nh√≥m m·∫∑c ƒë·ªãnh")){i('Kh√¥ng th·ªÉ t·∫°o nh√≥m v·ªõi t√™n "Default" ho·∫∑c "Nh√≥m m·∫∑c ƒë·ªãnh". Vui l√≤ng ch·ªçn t√™n kh√°c.');return}if(d&&m!==s.name){i("Kh√¥ng th·ªÉ thay ƒë·ªïi t√™n c·ªßa nh√≥m m·∫∑c ƒë·ªãnh.");return}x(!0),i("");try{const p={name:r.name.trim(),color:r.color,icon:r.icon};s?await N(f.uid,s.id,p):await l(f.uid,p),j?.(),c()}catch(p){i(p.message||"An error occurred")}finally{x(!1)}},g=(a,m)=>{v(d=>({...d,[a]:m}))},w=["üìÅ","üíº","üè†","üéØ","üìö","üí°","üîß","üé®","üèÉ‚Äç‚ôÇÔ∏è","üçï","üéµ","üåü"],b=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6","#EC4899","#06B6D4","#84CC16"];return e.jsx(B,{isOpen:!0,onClose:c,title:s?"Ch·ªânh s·ª≠a Nh√≥m":"T·∫°o Nh√≥m m·ªõi",children:e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[k&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:k}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Group Name *"}),e.jsx("input",{type:"text",required:!0,value:r.name,onChange:a=>g("name",a.target.value),className:"input-field",placeholder:"Enter group name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Icon"}),e.jsx("div",{className:"grid grid-cols-6 gap-2",children:w.map(a=>e.jsx("button",{type:"button",onClick:()=>g("icon",a),className:`p-2 text-lg rounded border-2 transition-colors ${r.icon===a?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"}`,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Color"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:b.map(a=>e.jsx("button",{type:"button",onClick:()=>g("color",a),className:`w-full h-8 rounded border-2 transition-all ${r.color===a?"border-gray-800 scale-110":"border-gray-200 hover:scale-105"}`,style:{backgroundColor:a}},a))})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:c,className:"btn-secondary",disabled:u,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:u||!r.name.trim(),children:u?e.jsx(X,{size:"sm"}):s?"Update Group":"Create Group"})]})]})})},P=()=>{const{user:s}=D(),{groups:c,fetchGroups:j,deleteGroup:f}=G(),{filters:l,setFilters:N,tasks:u}=R(),[x,k]=h.useState(!0),[i,r]=h.useState(!1),[v,y]=h.useState(null),{confirm:g,ConfirmComponent:w}=L(),{showToast:b}=O();h.useEffect(()=>{j()},[j]);const a=t=>u.filter(n=>n.groupId===t).length,m=()=>{const n=c.filter(o=>o.name==="Default"||o.name==="Nh√≥m m·∫∑c ƒë·ªãnh").map(o=>o.id);return u.filter(o=>!o.groupId||n.includes(o.groupId)).length},d=t=>{l.groupId===t?N({...l,groupId:void 0}):N({...l,groupId:t||void 0})},p=async t=>{if(!s)return;const n=c.find(C=>C.id===t),o=a(t);g("X√≥a nh√≥m",`B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a nh√≥m "${n?.name}"? ${o>0?`${o} task(s) s·∫Ω ƒë∆∞·ª£c chuy·ªÉn v·ªÅ nh√≥m Default.`:""}`,async()=>{try{await f(s.uid,t),b(`ƒê√£ x√≥a nh√≥m "${n?.name}" th√†nh c√¥ng`,"success")}catch{b("C√≥ l·ªói x·∫£y ra khi x√≥a nh√≥m","error")}},"danger","X√≥a nh√≥m")},F=t=>{y(t),r(!0)};return e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("button",{onClick:()=>k(!x),className:"flex items-center text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:[x?e.jsx(S,{className:"w-4 h-4 mr-1"}):e.jsx($,{className:"w-4 h-4 mr-1"}),"Groups"]}),e.jsx("button",{onClick:()=>r(!0),className:"text-gray-400 hover:text-primary-600","aria-label":"Th√™m nh√≥m m·ªõi",children:e.jsx(E,{className:"w-4 h-4"})})]}),x&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("button",{onClick:()=>d(null),className:`w-full flex items-center justify-between px-2 py-1.5 text-sm rounded-md transition-colors ${l.groupId===void 0?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-white"}`,children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"mr-2 text-xs",children:"üìã"}),e.jsx("span",{className:"text-xs",children:"Default"})]}),e.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:m()})]}),c.filter(t=>t.name!=="Default"&&t.name!=="Nh√≥m m·∫∑c ƒë·ªãnh").map(t=>e.jsxs("div",{className:"group relative",children:[e.jsxs("button",{onClick:()=>d(t.id),className:`w-full flex items-center justify-between px-2 py-1.5 text-sm rounded-md transition-colors ${l.groupId===t.id?"bg-primary-100 text-primary-900 dark:bg-primary-900 dark:text-primary-100":"text-gray-600 hover:bg-gray-50 hover:text-gray-900 dark:text-gray-300 dark:hover:bg-gray-700 dark:hover:text-white"}`,children:[e.jsxs("div",{className:"flex items-center min-w-0",children:[e.jsx("span",{className:"mr-2 text-xs",children:t.icon}),e.jsx("span",{className:"text-xs truncate",children:t.name})]}),e.jsx("div",{className:"flex items-center space-x-1 ml-2",children:e.jsx("span",{className:"text-xs bg-gray-200 dark:bg-gray-600 px-1.5 py-0.5 rounded-full min-w-[20px] text-center",children:a(t.id)})})]}),!(t.name==="Default"||t.name==="Nh√≥m m·∫∑c ƒë·ªãnh")&&e.jsxs("div",{className:"absolute right-8 top-1/2 transform -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-0.5 bg-white dark:bg-gray-800 rounded shadow-sm",children:[e.jsx("button",{onClick:n=>{n.stopPropagation(),F(t)},className:"p-1 text-gray-400 hover:text-blue-600 rounded","aria-label":`Ch·ªânh s·ª≠a nh√≥m ${t.name}`,children:e.jsx(I,{className:"w-3 h-3"})}),e.jsx("button",{onClick:n=>{n.stopPropagation(),p(t.id)},className:"p-1 text-gray-400 hover:text-red-600 rounded","aria-label":`X√≥a nh√≥m ${t.name}`,children:e.jsx(T,{className:"w-3 h-3"})})]})]},t.id))]}),i&&e.jsx(q,{group:v,onClose:()=>{r(!1),y(null)},onSuccess:()=>{r(!1),y(null),b(v?"C·∫≠p nh·∫≠t nh√≥m th√†nh c√¥ng":"T·∫°o nh√≥m th√†nh c√¥ng","success")}}),e.jsx(w,{})]})};export{P as G};
