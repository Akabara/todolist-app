import{r as p,j as e,l as F,c as M,a as P,m as R,d as $,e as G,n as H,p as U,k as _}from"./vendor-CvCHbQ4q.js";import{a as k,u as S,c as E,T as n,P as d,M as A,b as Q}from"./calendar-B9Gsgtge.js";import{u as O,L as I,a as T}from"./auth-VFuffwwi.js";const L=({task:t,onClose:l,onSuccess:c})=>{const{user:i}=O(),{createTask:g,updateTask:w,refreshTasks:f}=k(),{groups:u,fetchGroups:N,getDefaultGroup:j}=S(),[a,o]=p.useState(!1),[x,m]=p.useState(""),{showToast:C}=E(),[r,v]=p.useState({title:t?.title||"",description:t?.description||"",startDate:t?.startDate?t.startDate.toISOString().split("T")[0]:new Date().toISOString().split("T")[0],dueDate:t?.dueDate?t.dueDate.toISOString().split("T")[0]:"",priority:t?.priority||d.MEDIUM,status:t?.status||n.TODO,groupId:t?.groupId||""});p.useEffect(()=>{u.length===0&&N()},[N,u.length]);const D=async s=>{if(s.preventDefault(),!i){m("User not authenticated");return}o(!0),m("");try{const y=j(),b={title:r.title.trim(),description:r.description.trim()||void 0,startDate:r.startDate?new Date(r.startDate):new Date,dueDate:r.dueDate?new Date(r.dueDate):void 0,priority:r.priority,status:r.status,groupId:r.groupId||y.id,isCompleted:r.status===n.COMPLETED,completedAt:r.status===n.COMPLETED?new Date:void 0};T("Task data prepared",b),t?(T("Updating existing task",t.id),await w(i.uid,t.id,b)):(T("Creating new task for user",i.uid),await g(i.uid,b)),T("Task operation completed successfully"),C(t?"Cập nhật task thành công":"Tạo task thành công","success"),f(),c?.(),l()}catch(y){const b=y.message||"Có lỗi xảy ra";m(b),C(b,"error")}finally{o(!1)}},h=(s,y)=>{v(b=>({...b,[s]:y}))};return e.jsx(A,{isOpen:!0,onClose:l,title:t?"Chỉnh sửa Task":"Tạo Task mới",className:"max-w-4xl",children:e.jsxs("form",{onSubmit:D,className:"space-y-4",children:[x&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:x}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tiêu đề *"}),e.jsx("input",{type:"text",required:!0,value:r.title,onChange:s=>h("title",s.target.value),className:"input-field",placeholder:"Nhập tiêu đề task",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.title.length,"/200 ký tự"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Mô tả"}),e.jsx("textarea",{value:r.description,onChange:s=>h("description",s.target.value),className:"input-field",rows:2,placeholder:"Nhập mô tả task",maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[r.description.length,"/1000 ký tự"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ngày bắt đầu"}),e.jsx("input",{type:"date",value:r.startDate,onChange:s=>h("startDate",s.target.value),className:"input-field"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày bắt đầu thực hiện"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hạn hoàn thành"}),e.jsx("input",{type:"date",value:r.dueDate,onChange:s=>h("dueDate",s.target.value),className:"input-field",min:r.startDate||void 0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày cần hoàn thành"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Độ ưu tiên"}),e.jsxs("select",{value:r.priority,onChange:s=>h("priority",s.target.value),className:"input-field",children:[e.jsx("option",{value:d.LOW,children:"🟢 Thấp"}),e.jsx("option",{value:d.MEDIUM,children:"🟡 Trung bình"}),e.jsx("option",{value:d.HIGH,children:"🟠 Cao"}),e.jsx("option",{value:d.URGENT,children:"🔴 Khẩn cấp"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Mức độ quan trọng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trạng thái"}),e.jsxs("select",{value:r.status,onChange:s=>h("status",s.target.value),className:"input-field",children:[e.jsx("option",{value:n.TODO,children:"📝 Chưa làm"}),e.jsx("option",{value:n.IN_PROGRESS,children:"⚡ Đang làm"}),e.jsx("option",{value:n.COMPLETED,children:"✅ Hoàn thành"}),e.jsx("option",{value:n.CANCELLED,children:"❌ Đã hủy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Tình trạng hiện tại"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nhóm"}),e.jsxs("select",{value:r.groupId,onChange:s=>h("groupId",s.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"📋 Nhóm mặc định"}),u.filter(s=>s.name!=="Default"&&s.name!=="Nhóm mặc định").map(s=>e.jsxs("option",{value:s.id,children:[s.icon," ",s.name]},s.id))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Phân loại task theo nhóm"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",disabled:a,children:"Hủy"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:a||!r.title.trim(),children:a?e.jsx(I,{size:"sm"}):t?"Cập nhật Task":"Tạo Task"})]})]})})},z=({task:t})=>{const{user:l}=O(),{toggleTaskCompletion:c,deleteTask:i}=k(),{getGroupById:g,getDefaultGroup:w}=S(),[f,u]=p.useState(!1),[N,j]=p.useState(!1),{confirm:a,ConfirmComponent:o}=Q(),{showToast:x}=E(),m=t.groupId?g(t.groupId):w(),C=s=>{switch(s){case d.URGENT:return"text-red-600 bg-red-100 border-red-200";case d.HIGH:return"text-orange-600 bg-orange-100 border-orange-200";case d.MEDIUM:return"text-yellow-600 bg-yellow-100 border-yellow-200";case d.LOW:return"text-green-600 bg-green-100 border-green-200";default:return"text-gray-600 bg-gray-100 border-gray-200"}},r=s=>{switch(s){case n.COMPLETED:return"text-green-600 bg-green-100";case n.IN_PROGRESS:return"text-blue-600 bg-blue-100";case n.TODO:return"text-gray-600 bg-gray-100";case n.CANCELLED:return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},v=t.dueDate&&t.dueDate<new Date&&!t.isCompleted,D=async()=>{if(!l)return;u(!0);const s=!t.isCompleted;console.log("🔄 Toggling task completion:",{taskId:t.id,title:t.title,currentState:t.isCompleted,newState:s,isOverdue:v,dueDate:t.dueDate,status:t.status});try{await c(l.uid,t.id,s),x(t.isCompleted?"Đã đánh dấu task chưa hoàn thành":"Đã hoàn thành task!","success")}catch(y){console.error("❌ Error toggling task completion:",y),x(`Có lỗi xảy ra: ${y.message}`,"error")}finally{u(!1)}},h=()=>{l&&a("Xóa task",`Bạn có chắc chắn muốn xóa task "${t.title}"?`,async()=>{u(!0);try{await i(l.uid,t.id),x("Đã xóa task thành công","success")}catch{x("Có lỗi xảy ra khi xóa task","error")}finally{u(!1)}},"danger","Xóa task")};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 p-6 ${t.isCompleted?"border-green-500":v?"border-red-500":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("button",{onClick:D,disabled:f,className:"mt-1 text-gray-400 hover:text-green-600 transition-colors","aria-label":t.isCompleted?"Đánh dấu chưa hoàn thành":"Đánh dấu hoàn thành",children:t.isCompleted?e.jsx(F,{className:"w-6 h-6 text-green-600"}):e.jsx(M,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`text-lg font-medium ${t.isCompleted?"text-gray-500 line-through":"text-gray-900 dark:text-white"}`,children:t.title}),t.description&&e.jsx("p",{className:`mt-1 text-sm ${t.isCompleted?"text-gray-400":"text-gray-600 dark:text-gray-300"}`,children:t.description}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${C(t.priority)}`,children:t.priority}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${r(t.status)}`,children:t.status.replace("-"," ")}),t.dueDate&&e.jsxs("div",{className:`flex items-center text-xs ${v?"text-red-600":"text-gray-500"}`,children:[v&&e.jsx(P,{className:"w-4 h-4 mr-1"}),e.jsx(R,{className:"w-4 h-4 mr-1"}),"Due: ",t.dueDate.toLocaleDateString()]}),m&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("span",{className:"mr-1",children:m.icon}),e.jsx("span",{children:m.name})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>j(!0),className:"text-gray-400 hover:text-blue-600 transition-colors","aria-label":"Chỉnh sửa task",children:e.jsx($,{className:"w-5 h-5"})}),e.jsx("button",{onClick:h,disabled:f,className:"text-gray-400 hover:text-red-600 transition-colors","aria-label":"Xóa task",children:e.jsx(G,{className:"w-5 h-5"})})]})]}),N&&e.jsx(L,{task:t,onClose:()=>j(!1),onSuccess:()=>{j(!1),x("Cập nhật task thành công","success")}}),e.jsx(o,{})]})},W=()=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 border-gray-300 p-6 animate-pulse",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full mb-1"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-16"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-20"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-24"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})]})]})}),X=({count:t=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:t}).map((l,c)=>e.jsx(W,{},c))}),q=()=>{const{getFilteredTasks:t,loading:l}=k(),c=t();return l?e.jsx(X,{count:5}):c.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Không tìm thấy task nào. Tạo task đầu tiên để bắt đầu!"})}):e.jsx("div",{className:"space-y-4",children:c.map(i=>e.jsx(z,{task:i},i.id))})},B=()=>{const{filters:t,setFilters:l}=k(),[c,i]=p.useState(t.searchQuery||""),g=a=>{const o=t.status||[],x=o.includes(a)?o.filter(m=>m!==a):[...o,a];l({...t,status:x})},w=a=>{const o=t.priority||[],x=o.includes(a)?o.filter(m=>m!==a):[...o,a];l({...t,priority:x})},f=a=>{i(a),l({...t,searchQuery:a||void 0})},u=()=>{l({}),i("")},N=[{value:n.TODO,label:"To Do",color:"bg-gray-100 text-gray-800"},{value:n.IN_PROGRESS,label:"In Progress",color:"bg-blue-100 text-blue-800"},{value:n.COMPLETED,label:"Completed",color:"bg-green-100 text-green-800"},{value:n.CANCELLED,label:"Cancelled",color:"bg-red-100 text-red-800"}],j=[{value:d.LOW,label:"Low",color:"bg-green-100 text-green-800"},{value:d.MEDIUM,label:"Medium",color:"bg-yellow-100 text-yellow-800"},{value:d.HIGH,label:"High",color:"bg-orange-100 text-orange-800"},{value:d.URGENT,label:"Urgent",color:"bg-red-100 text-red-800"}];return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(H,{className:"w-5 h-5 mr-2"}),"Filters"]}),e.jsx("button",{onClick:u,className:"text-sm text-primary-600 hover:text-primary-700",children:"Clear all"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tasks...",value:c,onChange:a=>f(a.target.value),className:"input-field pl-10"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Status"}),e.jsx("div",{className:"space-y-2",children:N.map(a=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.status?.includes(a.value)||!1,onChange:()=>g(a.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${a.color}`,children:a.label})]},a.value))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Priority"}),e.jsx("div",{className:"space-y-2",children:j.map(a=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.priority?.includes(a.value)||!1,onChange:()=>w(a.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${a.color}`,children:a.label})]},a.value))})]})]})},K=()=>{const{loading:t,fetchTasks:l,cleanup:c}=k(),[i,g]=p.useState(!1);return p.useEffect(()=>(l(),()=>{c()}),[l,c]),t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(I,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Tasks"}),e.jsxs("button",{onClick:()=>g(!0),className:"btn-primary flex items-center",children:[e.jsx(_,{className:"w-5 h-5 mr-2"}),"New Task"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(B,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(q,{})})]}),i&&e.jsx(L,{onClose:()=>g(!1),onSuccess:()=>g(!1)})]})},Z=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{L as T,Z as a};
