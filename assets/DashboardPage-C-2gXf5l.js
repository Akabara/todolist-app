import{r as m,j as e,B as j,C as p,k as y,c as u,m as k,a as N}from"./vendor-CvCHbQ4q.js";import{a as b,T as x,D as w}from"./calendar-DfZfvuue.js";import{d as v,g as D,u as T,L as S}from"./auth-VFuffwwi.js";import{f as E,x as C,p as R,h as F,j as L}from"./firebase-vendor-D-WO-jOu.js";import{T as P}from"./tasks-Dc86kIwL.js";import"./state-vendor-BlHBy2Yi.js";class ${prefDocRef(t){return E(v,"users",t,"settings","preferences")}async getPreferences(t){const s=this.prefDocRef(t),c=await C(s);return c.exists()?c.data():null}subscribe(t,s){const c=this.prefDocRef(t);return R(c,r=>{if(!r.exists())return s(null);s(r.data())})}async setTheme(t,s){try{const c=this.prefDocRef(t);return await F(c,{theme:s,updatedAt:L()},{merge:!0}),{error:null}}catch(c){return{error:D(c)}}}}const g=new $,I=()=>{const[a,t]=m.useState(!1),{user:s}=T();m.useEffect(()=>{const r=document.documentElement,d=r.classList.contains("dark");if(t(d),!!s)try{const o=g.subscribe(s.uid,h=>{const n=h?.theme;if(!n)return;const l=n==="dark";r.classList.toggle("dark",l),t(l);try{localStorage.setItem("theme",l?"dark":"light")}catch{}});return()=>{o&&o()}}catch{g.getPreferences(s.uid).then(h=>{const n=h?.theme;if(!n)return;const l=n==="dark";r.classList.toggle("dark",l),t(l);try{localStorage.setItem("theme",l?"dark":"light")}catch{}}).catch(()=>{})}},[s]);const c=async()=>{const r=document.documentElement,d=!a;r.classList.toggle("dark",d),t(d);try{localStorage.setItem("theme",d?"dark":"light")}catch{}if(s)try{await g.setTheme(s.uid,d?"dark":"light")}catch{}};return e.jsx("button",{type:"button",onClick:c,"aria-pressed":a,title:a?"Switch to light mode":"Switch to dark mode",className:"inline-flex items-center justify-center rounded-lg border border-gray-300 dark:border-gray-600 p-2 text-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500",children:a?e.jsx(j,{className:"w-5 h-5"}):e.jsx(p,{className:"w-5 h-5"})})},G=()=>{const{tasks:a,loading:t,fetchTasks:s}=b(),[c,r]=m.useState(!1),[d,o]=m.useState({total:0,completed:0,pending:0,overdue:0});return m.useEffect(()=>{s()},[s]),m.useEffect(()=>{const h=new Date,n=a.filter(i=>i.status===x.COMPLETED).length,l=a.filter(i=>i.status!==x.COMPLETED).length,f=a.filter(i=>i.dueDate&&i.dueDate<h&&i.status!==x.COMPLETED).length;o({total:a.length,completed:n,pending:l,overdue:f})},[a]),t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),e.jsxs("button",{onClick:()=>r(!0),className:"btn-primary flex items-center",children:[e.jsx(y,{className:"w-5 h-5 mr-2"}),"New Task"]})]}),e.jsx(I,{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.total})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.completed})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(k,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.pending})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(N,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.overdue})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Calendar"})}),e.jsxs("div",{className:"p-6",children:[e.jsx(w,{tasks:a}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Double-click vào ngày để xem chi tiết công việc"})})]})]}),c&&e.jsx(P,{onClose:()=>r(!1),onSuccess:()=>r(!1)})]})};export{G as default};
