import{r as g,j as e,l as I,c as F,a as M,m as P,d as R,e as $,n as G,p as H,k as U}from"./vendor-C0uaCzFa.js";import{a as k,u as D,c as S,T as c,P as x,M as _,b as A}from"./calendar-75FORc-3.js";import{u as E,L as O,a as C}from"./auth-Bq53jqvI.js";const L=({task:t,onClose:l,onSuccess:d})=>{const{user:i}=E(),{createTask:b,updateTask:v}=k(),{groups:j,fetchGroups:h,getDefaultGroup:w}=D(),[p,f]=g.useState(!1),[s,n]=g.useState(""),{showToast:u}=S(),[a,T]=g.useState({title:t?.title||"",description:t?.description||"",startDate:t?.startDate?t.startDate.toISOString().split("T")[0]:"",dueDate:t?.dueDate?t.dueDate.toISOString().split("T")[0]:"",priority:t?.priority||x.MEDIUM,status:t?.status||c.TODO,groupId:t?.groupId||""});g.useEffect(()=>{h()},[h]);const N=async r=>{if(r.preventDefault(),!i){n("User not authenticated");return}f(!0),n("");try{const o=w(),m={title:a.title.trim(),description:a.description.trim()||void 0,startDate:a.startDate?new Date(a.startDate):void 0,dueDate:a.dueDate?new Date(a.dueDate):void 0,priority:a.priority,status:a.status,groupId:a.groupId||o.id,isCompleted:a.status===c.COMPLETED,completedAt:a.status===c.COMPLETED?new Date:void 0};C("Task data prepared",m),t?(C("Updating existing task",t.id),await v(i.uid,t.id,m)):(C("Creating new task for user",i.uid),await b(i.uid,m)),C("Task operation completed successfully"),u(t?"Cập nhật task thành công":"Tạo task thành công","success"),d?.(),l()}catch(o){const m=o.message||"Có lỗi xảy ra";n(m),u(m,"error")}finally{f(!1)}},y=(r,o)=>{T(m=>({...m,[r]:o}))};return e.jsx(_,{isOpen:!0,onClose:l,title:t?"Chỉnh sửa Task":"Tạo Task mới",className:"max-w-4xl",children:e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[s&&e.jsx("div",{className:"text-red-600 text-sm bg-red-50 dark:bg-red-900/20 p-3 rounded",children:s}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Tiêu đề *"}),e.jsx("input",{type:"text",required:!0,value:a.title,onChange:r=>y("title",r.target.value),className:"input-field",placeholder:"Nhập tiêu đề task",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.title.length,"/200 ký tự"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Mô tả"}),e.jsx("textarea",{value:a.description,onChange:r=>y("description",r.target.value),className:"input-field",rows:2,placeholder:"Nhập mô tả task",maxLength:1e3}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:[a.description.length,"/1000 ký tự"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Ngày bắt đầu"}),e.jsx("input",{type:"date",value:a.startDate,onChange:r=>y("startDate",r.target.value),className:"input-field"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày bắt đầu thực hiện"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Hạn hoàn thành"}),e.jsx("input",{type:"date",value:a.dueDate,onChange:r=>y("dueDate",r.target.value),className:"input-field",min:a.startDate||void 0}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Ngày cần hoàn thành"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Độ ưu tiên"}),e.jsxs("select",{value:a.priority,onChange:r=>y("priority",r.target.value),className:"input-field",children:[e.jsx("option",{value:x.LOW,children:"🟢 Thấp"}),e.jsx("option",{value:x.MEDIUM,children:"🟡 Trung bình"}),e.jsx("option",{value:x.HIGH,children:"🟠 Cao"}),e.jsx("option",{value:x.URGENT,children:"🔴 Khẩn cấp"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Mức độ quan trọng"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Trạng thái"}),e.jsxs("select",{value:a.status,onChange:r=>y("status",r.target.value),className:"input-field",children:[e.jsx("option",{value:c.TODO,children:"📝 Chưa làm"}),e.jsx("option",{value:c.IN_PROGRESS,children:"⚡ Đang làm"}),e.jsx("option",{value:c.COMPLETED,children:"✅ Hoàn thành"}),e.jsx("option",{value:c.CANCELLED,children:"❌ Đã hủy"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Tình trạng hiện tại"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nhóm"}),e.jsxs("select",{value:a.groupId,onChange:r=>y("groupId",r.target.value),className:"input-field",children:[e.jsx("option",{value:"",children:"📋 Nhóm mặc định"}),j.filter(r=>r.name!=="Default"&&r.name!=="Nhóm mặc định").map(r=>e.jsxs("option",{value:r.id,children:[r.icon," ",r.name]},r.id))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Phân loại task theo nhóm"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("button",{type:"button",onClick:l,className:"btn-secondary",disabled:p,children:"Hủy"}),e.jsx("button",{type:"submit",className:"btn-primary",disabled:p||!a.title.trim(),children:p?e.jsx(O,{size:"sm"}):t?"Cập nhật Task":"Tạo Task"})]})]})})},Q=({task:t})=>{const{user:l}=E(),{toggleTaskCompletion:d,deleteTask:i}=k(),{getGroupById:b,getDefaultGroup:v}=D(),[j,h]=g.useState(!1),[w,p]=g.useState(!1),{confirm:f,ConfirmComponent:s}=A(),{showToast:n}=S(),u=t.groupId?b(t.groupId):v(),a=o=>{switch(o){case x.URGENT:return"text-red-600 bg-red-100 border-red-200";case x.HIGH:return"text-orange-600 bg-orange-100 border-orange-200";case x.MEDIUM:return"text-yellow-600 bg-yellow-100 border-yellow-200";case x.LOW:return"text-green-600 bg-green-100 border-green-200";default:return"text-gray-600 bg-gray-100 border-gray-200"}},T=o=>{switch(o){case c.COMPLETED:return"text-green-600 bg-green-100";case c.IN_PROGRESS:return"text-blue-600 bg-blue-100";case c.TODO:return"text-gray-600 bg-gray-100";case c.CANCELLED:return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},N=t.dueDate&&t.dueDate<new Date&&!t.isCompleted,y=async()=>{if(!l)return;h(!0);const o=!t.isCompleted;console.log("🔄 Toggling task completion:",{taskId:t.id,title:t.title,currentState:t.isCompleted,newState:o,isOverdue:N,dueDate:t.dueDate,status:t.status});try{await d(l.uid,t.id,o),n(t.isCompleted?"Đã đánh dấu task chưa hoàn thành":"Đã hoàn thành task!","success")}catch(m){console.error("❌ Error toggling task completion:",m),n(`Có lỗi xảy ra: ${m.message}`,"error")}finally{h(!1)}},r=()=>{l&&f("Xóa task",`Bạn có chắc chắn muốn xóa task "${t.title}"?`,async()=>{h(!0);try{await i(l.uid,t.id),n("Đã xóa task thành công","success")}catch{n("Có lỗi xảy ra khi xóa task","error")}finally{h(!1)}},"danger","Xóa task")};return e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 p-6 ${t.isCompleted?"border-green-500":N?"border-red-500":"border-gray-300"}`,children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start space-x-3 flex-1",children:[e.jsx("button",{onClick:y,disabled:j,className:"mt-1 text-gray-400 hover:text-green-600 transition-colors","aria-label":t.isCompleted?"Đánh dấu chưa hoàn thành":"Đánh dấu hoàn thành",children:t.isCompleted?e.jsx(I,{className:"w-6 h-6 text-green-600"}):e.jsx(F,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:`text-lg font-medium ${t.isCompleted?"text-gray-500 line-through":"text-gray-900 dark:text-white"}`,children:t.title}),t.description&&e.jsx("p",{className:`mt-1 text-sm ${t.isCompleted?"text-gray-400":"text-gray-600 dark:text-gray-300"}`,children:t.description}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${a(t.priority)}`,children:t.priority}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${T(t.status)}`,children:t.status.replace("-"," ")}),t.dueDate&&e.jsxs("div",{className:`flex items-center text-xs ${N?"text-red-600":"text-gray-500"}`,children:[N&&e.jsx(M,{className:"w-4 h-4 mr-1"}),e.jsx(P,{className:"w-4 h-4 mr-1"}),"Due: ",t.dueDate.toLocaleDateString()]}),u&&e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx("span",{className:"mr-1",children:u.icon}),e.jsx("span",{children:u.name})]})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>p(!0),className:"text-gray-400 hover:text-blue-600 transition-colors","aria-label":"Chỉnh sửa task",children:e.jsx(R,{className:"w-5 h-5"})}),e.jsx("button",{onClick:r,disabled:j,className:"text-gray-400 hover:text-red-600 transition-colors","aria-label":"Xóa task",children:e.jsx($,{className:"w-5 h-5"})})]})]}),w&&e.jsx(L,{task:t,onClose:()=>p(!1),onSuccess:()=>{p(!1),n("Cập nhật task thành công","success")}}),e.jsx(s,{})]})},z=()=>e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow border-l-4 border-gray-300 p-6 animate-pulse",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-5 bg-gray-200 dark:bg-gray-700 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-full mb-1"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3 mb-3"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-16"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-20"}),e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded-full w-24"})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"}),e.jsx("div",{className:"w-5 h-5 bg-gray-200 dark:bg-gray-700 rounded"})]})]})}),W=({count:t=3})=>e.jsx("div",{className:"space-y-4",children:Array.from({length:t}).map((l,d)=>e.jsx(z,{},d))}),X=()=>{const{getFilteredTasks:t,loading:l}=k(),d=t();return l?e.jsx(W,{count:5}):d.length===0?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-8 text-center",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Không tìm thấy task nào. Tạo task đầu tiên để bắt đầu!"})}):e.jsx("div",{className:"space-y-4",children:d.map(i=>e.jsx(Q,{task:i},i.id))})},q=()=>{const{filters:t,setFilters:l}=k(),{fetchGroups:d}=D(),[i,b]=g.useState(t.searchQuery||"");g.useEffect(()=>{d()},[d]);const v=s=>{const n=t.status||[],u=n.includes(s)?n.filter(a=>a!==s):[...n,s];l({...t,status:u})},j=s=>{const n=t.priority||[],u=n.includes(s)?n.filter(a=>a!==s):[...n,s];l({...t,priority:u})},h=s=>{b(s),l({...t,searchQuery:s||void 0})},w=()=>{l({}),b("")},p=[{value:c.TODO,label:"To Do",color:"bg-gray-100 text-gray-800"},{value:c.IN_PROGRESS,label:"In Progress",color:"bg-blue-100 text-blue-800"},{value:c.COMPLETED,label:"Completed",color:"bg-green-100 text-green-800"},{value:c.CANCELLED,label:"Cancelled",color:"bg-red-100 text-red-800"}],f=[{value:x.LOW,label:"Low",color:"bg-green-100 text-green-800"},{value:x.MEDIUM,label:"Medium",color:"bg-yellow-100 text-yellow-800"},{value:x.HIGH,label:"High",color:"bg-orange-100 text-orange-800"},{value:x.URGENT,label:"Urgent",color:"bg-red-100 text-red-800"}];return e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-white flex items-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2"}),"Filters"]}),e.jsx("button",{onClick:w,className:"text-sm text-primary-600 hover:text-primary-700",children:"Clear all"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(H,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search tasks...",value:i,onChange:s=>h(s.target.value),className:"input-field pl-10"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Status"}),e.jsx("div",{className:"space-y-2",children:p.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.status?.includes(s.value)||!1,onChange:()=>v(s.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:s.label})]},s.value))})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3",children:"Priority"}),e.jsx("div",{className:"space-y-2",children:f.map(s=>e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:t.priority?.includes(s.value)||!1,onChange:()=>j(s.value),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),e.jsx("span",{className:`ml-2 px-2 py-1 rounded-full text-xs font-medium ${s.color}`,children:s.label})]},s.value))})]})]})},B=()=>{const{loading:t,fetchTasks:l}=k(),[d,i]=g.useState(!1);return g.useEffect(()=>{l()},[l]),t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(O,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Tasks"}),e.jsxs("button",{onClick:()=>i(!0),className:"btn-primary flex items-center",children:[e.jsx(U,{className:"w-5 h-5 mr-2"}),"New Task"]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(q,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsx(X,{})})]}),d&&e.jsx(L,{onClose:()=>i(!1),onSuccess:()=>i(!1)})]})},Y=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{L as T,Y as a};
