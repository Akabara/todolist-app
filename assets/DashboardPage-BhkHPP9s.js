import{r as m,j as e,B as p,C as y,k,c as u,m as N,a as b}from"./vendor-CvCHbQ4q.js";import{a as w,T as x,D as v}from"./calendar-B9Gsgtge.js";import{d as D,g as T,u as S,L as E}from"./auth-VFuffwwi.js";import{f as C,x as R,p as F,h as L,j as P}from"./firebase-vendor-D-WO-jOu.js";import{T as $}from"./tasks-B0IvL4wu.js";import"./state-vendor-BlHBy2Yi.js";class I{prefDocRef(t){return C(D,"users",t,"settings","preferences")}async getPreferences(t){const s=this.prefDocRef(t),r=await R(s);return r.exists()?r.data():null}subscribe(t,s){const r=this.prefDocRef(t);return F(r,c=>{if(!c.exists())return s(null);s(c.data())})}async setTheme(t,s){try{const r=this.prefDocRef(t);return await L(r,{theme:s,updatedAt:P()},{merge:!0}),{error:null}}catch(r){return{error:T(r)}}}}const g=new I,M=()=>{const[a,t]=m.useState(!1),{user:s}=S();m.useEffect(()=>{const c=document.documentElement,l=c.classList.contains("dark");if(t(l),!!s)try{const d=g.subscribe(s.uid,h=>{const i=h?.theme;if(!i)return;const n=i==="dark";c.classList.toggle("dark",n),t(n);try{localStorage.setItem("theme",n?"dark":"light")}catch{}});return()=>{d&&d()}}catch{g.getPreferences(s.uid).then(h=>{const i=h?.theme;if(!i)return;const n=i==="dark";c.classList.toggle("dark",n),t(n);try{localStorage.setItem("theme",n?"dark":"light")}catch{}}).catch(()=>{})}},[s]);const r=async()=>{const c=document.documentElement,l=!a;c.classList.toggle("dark",l),t(l);try{localStorage.setItem("theme",l?"dark":"light")}catch{}if(s)try{await g.setTheme(s.uid,l?"dark":"light")}catch{}};return e.jsx("button",{type:"button",onClick:r,"aria-pressed":a,title:a?"Switch to light mode":"Switch to dark mode",className:"inline-flex items-center justify-center rounded-lg border border-gray-300 dark:border-gray-600 p-2 text-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500",children:a?e.jsx(p,{className:"w-5 h-5"}):e.jsx(y,{className:"w-5 h-5"})})},H=()=>{const{tasks:a,loading:t,fetchTasks:s,cleanup:r}=w(),[c,l]=m.useState(!1),[d,h]=m.useState({total:0,completed:0,pending:0,overdue:0});return m.useEffect(()=>(s(),()=>{r()}),[s,r]),m.useEffect(()=>{const i=new Date,n=a.filter(o=>o.status===x.COMPLETED).length,f=a.filter(o=>o.status!==x.COMPLETED).length,j=a.filter(o=>o.dueDate&&o.dueDate<i&&o.status!==x.COMPLETED).length;h({total:a.length,completed:n,pending:f,overdue:j})},[a]),t?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(E,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),e.jsxs("button",{onClick:()=>l(!0),className:"btn-primary flex items-center",children:[e.jsx(k,{className:"w-5 h-5 mr-2"}),"New Task"]})]}),e.jsx(M,{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.total})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(u,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.completed})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(N,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.pending})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(b,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:d.overdue})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Calendar"})}),e.jsxs("div",{className:"p-6",children:[e.jsx(v,{tasks:a}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Double-click vào ngày để xem chi tiết công việc"})})]})]}),c&&e.jsx($,{onClose:()=>l(!1),onSuccess:()=>l(!1)})]})};export{H as default};
