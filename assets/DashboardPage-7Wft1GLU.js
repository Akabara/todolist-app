import{r as o,d as ve,c as ke,g as we,o as je,s as De,e as Ne,f as Te,u as A,j as e,P as D,h as Ce,i as B,F as Me,T as R,L as Ee,k as Se,m as U,n as Le}from"./index-krZ33pOX.js";import{T as z,F as Oe}from"./TaskForm-DlHnM7Bg.js";function Re({title:r,titleId:a,...s},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},s),r?o.createElement("title",{id:a},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))}const G=o.forwardRef(Re);function Fe({title:r,titleId:a,...s},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},s),r?o.createElement("title",{id:a},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 19.5 8.25 12l7.5-7.5"}))}const Ie=o.forwardRef(Fe);function Pe({title:r,titleId:a,...s},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},s),r?o.createElement("title",{id:a},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"}))}const $e=o.forwardRef(Pe);function He({title:r,titleId:a,...s},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":a},s),r?o.createElement("title",{id:a},r):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"}))}const Ue=o.forwardRef(He);class Ge{prefDocRef(a){return ve(ke,"users",a,"settings","preferences")}async getPreferences(a){const s=this.prefDocRef(a),n=await we(s);return n.exists()?n.data():null}subscribe(a,s){const n=this.prefDocRef(a);return je(n,d=>{if(!d.exists())return s(null);s(d.data())})}async setTheme(a,s){try{const n=this.prefDocRef(a);return await De(n,{theme:s,updatedAt:Ne()},{merge:!0}),{error:null}}catch(n){return{error:Te(n)}}}}const W=new Ge,We=()=>{const[r,a]=o.useState(!1),{user:s}=A();o.useEffect(()=>{const d=document.documentElement,l=d.classList.contains("dark");if(a(l),!s)return;const g=W.subscribe(s.uid,u=>{const m=u==null?void 0:u.theme;if(!m)return;const y=m==="dark";d.classList.toggle("dark",y),a(y);try{localStorage.setItem("theme",y?"dark":"light")}catch{}});return()=>{g&&g()}},[s]);const n=async()=>{const d=document.documentElement,l=!r;d.classList.toggle("dark",l),a(l);try{localStorage.setItem("theme",l?"dark":"light")}catch{}if(s)try{await W.setTheme(s.uid,l?"dark":"light")}catch{}};return e.jsx("button",{type:"button",onClick:n,"aria-pressed":r,title:r?"Switch to light mode":"Switch to dark mode",className:"inline-flex items-center justify-center rounded-lg border border-gray-300 dark:border-gray-600 p-2 text-gray-600 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500",children:r?e.jsx(Ue,{className:"w-5 h-5"}):e.jsx($e,{className:"w-5 h-5"})})};function Ae(r,a){const s=new Date;s.setHours(0,0,0,0);const n=new Date(a);if(n.setHours(0,0,0,0),r.isCompleted)return{task:r,displayDate:n,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};if(!r.startDate){if(!r.dueDate)return{task:r,displayDate:n,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:!1};const x=new Date(r.dueDate);x.setHours(0,0,0,0);const b=x<s,N=x.getTime()===n.getTime();return{task:r,displayDate:n,isOverdue:b,isUrgent:b,urgencyLevel:b?"critical":"normal",shouldDisplay:N}}const d=new Date(r.startDate);d.setHours(0,0,0,0);const l=r.dueDate?new Date(r.dueDate):null;if(l&&l.setHours(0,0,0,0),s<d){const x=n.getTime()===d.getTime();return{task:r,displayDate:d,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:x}}if(l&&s>l){const x=n.getTime()===l.getTime();return{task:r,displayDate:l,isOverdue:!0,isUrgent:!0,urgencyLevel:"critical",shouldDisplay:x}}const g=n.getTime()===s.getTime();if(!l)return{task:r,displayDate:s,isOverdue:!1,isUrgent:!1,urgencyLevel:"normal",shouldDisplay:g};const u=Math.max(1,Math.ceil((l.getTime()-d.getTime())/(1e3*60*60*24))),m=Math.ceil((l.getTime()-s.getTime())/(1e3*60*60*24)),y=(u-m)/u;let p="normal",c=!1;return m<=1?(p="critical",c=!0):m<=3||y>=.8?(p="urgent",c=!0):y>=.6&&(p="urgent",c=!1),{task:r,displayDate:s,isOverdue:!1,isUrgent:c,urgencyLevel:p,shouldDisplay:g}}function Be(r,a){return r.map(s=>Ae(s,a)).filter(s=>s.shouldDisplay)}function ze(r,a){return a==="critical"?D.URGENT:a==="urgent"&&r.priority!==D.URGENT?D.HIGH:r.priority}const Je=({tasks:r})=>{const[a,s]=o.useState(new Date),[n,d]=o.useState(null),[l,g]=o.useState(null),[u,m]=o.useState(null),[y,p]=o.useState(null),[c,x]=o.useState(null),[b,N]=o.useState(null),{user:S}=A(),{getGroupById:F,getDefaultGroup:J}=Ce(),{filters:L,toggleTaskCompletion:Y,updateTask:V}=B(),X=L.groupId?r.filter(t=>t.groupId===L.groupId):r,v=a.getFullYear(),k=a.getMonth(),Z=new Date,q=new Date(v,k,1),K=new Date(v,k+1,0).getDate(),Q=q.getDay(),_=new Date(v,k-1,0),ee=Q,T=[];for(let t=ee;t>0;t--){const i=_.getDate()-t+1,h=new Date(v,k-1,i);T.push({date:h,day:i,isCurrentMonth:!1,isToday:!1})}for(let t=1;t<=K;t++){const i=new Date(v,k,t),h=i.toDateString()===Z.toDateString();T.push({date:i,day:t,isCurrentMonth:!0,isToday:h})}const te=42-T.length;for(let t=1;t<=te;t++){const i=new Date(v,k+1,t);T.push({date:i,day:t,isCurrentMonth:!1,isToday:!1})}const re=t=>Be(X,t),se=()=>{s(new Date(v,k-1,1))},ae=()=>{s(new Date(v,k+1,1))},ne=()=>{s(new Date)},oe=(t,i)=>{t.preventDefault(),t.stopPropagation(),!i.isCompleted&&g({x:t.clientX,y:t.clientY,task:i})},I=async t=>{if(S)try{await Y(S.uid,t.id,!0),g(null)}catch(i){console.error("Failed to mark task as done:",i)}},P=()=>{g(null),x(null)},le=(t,i)=>{if(i.isCompleted){t.preventDefault();return}m(i),t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",i.id)},ie=(t,i)=>{t.preventDefault(),t.dataTransfer.dropEffect="move",p(i)},de=()=>{p(null)},ce=async(t,i)=>{if(t.preventDefault(),p(null),!u||!S)return;const h=new Date(i);h.setHours(23,59,59,999);try{await V(S.uid,u.id,{dueDate:h}),m(null)}catch(C){console.error("Failed to update task due date:",C),m(null)}},ue=()=>{m(null),p(null)},ge=(t,i)=>{if(i.isCompleted)return;const h=t.touches[0],C=setTimeout(()=>{x({task:i,x:h.clientX,y:h.clientY})},500);N(C)},me=()=>{b&&(clearTimeout(b),N(null))},xe=()=>{b&&(clearTimeout(b),N(null))};o.useEffect(()=>{if(l||c)return document.addEventListener("click",P),()=>document.removeEventListener("click",P)},[l,c]),o.useEffect(()=>()=>{b&&clearTimeout(b)},[b]);const he=t=>{switch(t){case D.URGENT:return"bg-red-500";case D.HIGH:return"bg-orange-500";case D.MEDIUM:return"bg-yellow-500";case D.LOW:return"bg-green-500";default:return"bg-gray-500"}},fe=["January","February","March","April","May","June","July","August","September","October","November","December"],ye=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],$=(()=>{if(L.groupId){const t=F(L.groupId);return t?`${t.icon} ${t.name}`:"Unknown Group"}return null})();return e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[fe[k]," ",v]}),$&&e.jsxs("span",{className:"text-sm text-primary-600 dark:text-primary-400 bg-primary-50 dark:bg-primary-900/20 px-2 py-1 rounded-full",children:["Filtered by: ",$]}),e.jsx("button",{onClick:ne,className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"Today"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:se,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(Ie,{className:"w-5 h-5"})}),e.jsx("button",{onClick:ae,className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsx(Me,{className:"w-5 h-5"})})]})]}),e.jsx("div",{className:"grid grid-cols-7 gap-1 mb-2",children:ye.map(t=>e.jsx("div",{className:"p-2 text-center text-xs font-medium text-gray-500 dark:text-gray-400",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7 gap-1",children:T.map((t,i)=>{const h=re(t.date),C=(y==null?void 0:y.toDateString())===t.date.toDateString();return e.jsxs("div",{className:`min-h-[96px] p-2 border border-gray-200 dark:border-gray-700 rounded-lg transition-colors ${t.isCurrentMonth?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900"} ${t.isToday?"ring-2 ring-primary-500":""} ${C?"bg-primary-50 dark:bg-primary-900/20 border-primary-300 dark:border-primary-700 border-2":""}`,onDragOver:M=>ie(M,t.date),onDragLeave:de,onDrop:M=>ce(M,t.date),children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${t.isCurrentMonth?t.isToday?"text-primary-600 dark:text-primary-400":"text-gray-900 dark:text-white":"text-gray-400 dark:text-gray-600"}`,children:t.day}),e.jsxs("div",{className:"space-y-1",children:[h.slice(0,4).map(M=>{const{task:f,isOverdue:E,urgencyLevel:j}=M,O=f.groupId?F(f.groupId):J(),pe=ze(f,j),be=()=>E?"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200 border border-red-300 dark:border-red-700":j==="critical"?"bg-red-50 text-red-700 dark:bg-red-900/30 dark:text-red-300 border border-red-200 dark:border-red-800":j==="urgent"?"bg-orange-50 text-orange-700 dark:bg-orange-900/30 dark:text-orange-300 border border-orange-200 dark:border-orange-800":"bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-200";return e.jsx("div",{draggable:!f.isCompleted,className:`text-xs p-1 rounded truncate transition-all duration-200 ${be()} cursor-move hover:opacity-80 ${(u==null?void 0:u.id)===f.id?"opacity-50 scale-95":""}`,title:`${f.title} - ${(O==null?void 0:O.name)||"Default"} ${E?"(OVERDUE)":j==="critical"?"(CRITICAL)":j==="urgent"?"(URGENT)":""}`,onDragStart:w=>le(w,f),onDragEnd:ue,onDoubleClick:()=>d(f),onContextMenu:w=>oe(w,f),onTouchStart:w=>ge(w,f),onTouchEnd:me,onTouchMove:xe,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-1 flex-1 min-w-0",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${he(pe)}`}),e.jsx("span",{className:"truncate",children:f.title}),E&&e.jsx("span",{className:"text-red-600 font-bold",title:"Overdue",children:"⚠"}),!E&&j==="critical"&&e.jsx("span",{className:"text-red-500 font-bold",title:"Critical urgency",children:"🔥"}),!E&&j==="urgent"&&e.jsx("span",{className:"text-orange-500 font-bold",title:"Urgent",children:"⚡"})]}),e.jsx("button",{className:"ml-1 text-gray-400 hover:text-gray-600 lg:hidden flex-shrink-0",onClick:w=>{w.stopPropagation();const H=w.currentTarget.getBoundingClientRect();x({task:f,x:H.right,y:H.bottom})},"aria-label":"Tùy chọn task",children:"⋮"}),e.jsx("span",{className:"text-gray-400 text-xs hidden lg:block",children:"⋮⋮"})]})},f.id)}),h.length>4&&e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:["+",h.length-4," more"]})]})]},i)})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500"}),e.jsx("span",{children:"Urgent"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-orange-500"}),e.jsx("span",{children:"High"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-yellow-500"}),e.jsx("span",{children:"Medium"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsx("span",{children:"Low"})]})]}),l&&e.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:l.x,top:l.y},onClick:t=>t.stopPropagation(),children:[e.jsxs("button",{onClick:()=>I(l.task),className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Hoàn thành"})]}),e.jsxs("button",{onClick:()=>{d(l.task),g(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{children:"Chỉnh sửa"})]})]}),c&&e.jsxs("div",{className:"fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg shadow-lg py-1 z-50",style:{left:c.x,top:c.y},onClick:t=>t.stopPropagation(),children:[e.jsxs("button",{onClick:()=>{I(c.task),x(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx(G,{className:"w-4 h-4 text-green-600"}),e.jsx("span",{children:"Hoàn thành"})]}),e.jsxs("button",{onClick:()=>{d(c.task),x(null)},className:"w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),e.jsx("span",{children:"Chỉnh sửa"})]})]}),n&&e.jsx(z,{task:n,onClose:()=>d(null),onSuccess:()=>d(null)})]})},qe=()=>{const{tasks:r,loading:a,fetchTasks:s}=B(),[n,d]=o.useState(!1),[l,g]=o.useState({total:0,completed:0,pending:0,overdue:0});return o.useEffect(()=>{s()},[s]),o.useEffect(()=>{const u=new Date,m=r.filter(c=>c.status===R.COMPLETED).length,y=r.filter(c=>c.status!==R.COMPLETED).length,p=r.filter(c=>c.dueDate&&c.dueDate<u&&c.status!==R.COMPLETED).length;g({total:r.length,completed:m,pending:y,overdue:p})},[r]),a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(Ee,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),e.jsxs("button",{onClick:()=>d(!0),className:"btn-primary flex items-center",children:[e.jsx(Se,{className:"w-5 h-5 mr-2"}),"New Task"]})]}),e.jsx(We,{})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(U,{className:"w-6 h-6 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Total Tasks"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:l.total})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(U,{className:"w-6 h-6 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Completed"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:l.completed})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(Oe,{className:"w-6 h-6 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Pending"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:l.pending})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(Le,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:"Overdue"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:l.overdue})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsx("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Calendar"})}),e.jsx("div",{className:"p-6",children:e.jsx(Je,{tasks:r})})]}),n&&e.jsx(z,{onClose:()=>d(!1),onSuccess:()=>d(!1)})]})};export{qe as default};
